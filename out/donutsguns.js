/*! For license information please see donutsguns.js.LICENSE.txt */
(()=>{"use strict";var t={"./src/guns/AssaultRifle.ts":(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=ModAPI.reflect.getClassByName("DamageSource"),e=ModAPI.reflect.getClassById("net.minecraft.creativetab.CreativeTabs").staticVariables.tabMisc,n=ModAPI.reflect.getClassById("net.minecraft.item.Item"),i=ModAPI.reflect.getSuper(n,(function(t){return 1===t.length})),r=function(){i(this),this.$setCreativeTab(e)};ModAPI.reflect.prototypeStack(n,r);var o=!1;function a(){var t=(new r).$setUnlocalizedName(ModAPI.util.str("assaultrifle")).$setMaxStackSize(1);return n.staticMethods.registerItem.method(ModAPI.keygen.item("assaultrifle"),ModAPI.util.str("assaultrifle"),t),ModAPI.items.assaultrifle=t,t}if(r.prototype.$onPlayerStoppedUsing=function(t){o=!1},r.prototype.$onItemUseFinish=function(t){return t},r.prototype.$getMaxItemUseDuration=function(t){return 72e3},r.prototype.$getItemUseAction=function(t){return ModAPI.reflect.getClassByName("EnumAction").staticVariables.DRINK},r.prototype.$onItemRightClick=function(e,n,i){if(!o){o=!0;var a=t.staticVariables.cactus,s=ModAPI.util.wrap(n),c=ModAPI.util.wrap(i),l=function(t,e){for(var n=t.getPositionEyes(0),i=t.rayTrace(32,0).hitVec,r=e.getEntitiesWithinAABBExcludingEntity(t.getRef(),t.getEntityBoundingBox().expand(32,32,32).getRef()).getCorrective().array,o=null,a=!1,s=0,c=32,l=ModAPI.reflect.getClassByName("EnumParticleTypes").staticVariables.SMOKE_NORMAL,u=t.posX,d=t.posY+1.5,f=t.posZ,A=i.xCoord-u,p=i.yCoord-d,y=i.zCoord-f,g=Math.sqrt(A*A+p*p+y*y),I=A/g,m=p/g,h=y/g,M=g/50,P=0;P<=50;P++){var v=u+I*P*M,E=d+m*P*M,b=f+h*P*M;e.spawnParticle(l,v,E,b,0,0,0,[0])}for(P=0;P<r.length;P++)if(r[P]){var S=r[P],R=S.getEntityBoundingBox().expand(.3,.3,.3).calculateIntercept(n.getRef(),i.getRef());if(null!=R){var k=n.distanceTo(R.hitVec.getRef());k<c&&(c=k,o=S,(a=S.getPositionEyes(0).distanceTo(R.hitVec.getRef())<.72)&&(s=1))}}return null!=o?{entity:o,headshot:a,intheadshot:s}:null}(c,s);c.setItemInUse(e,r.prototype.$getMaxItemUseDuration(e)),null!=l?s.isRemote||(l.entity.attackEntityFrom(a,10+16*l.intheadshot),l.headshot&&console.log("H E A D S H O T"),s.playSoundAtEntity(c.getRef(),ModAPI.util.str("tile.piston.out"),1,1.8)):s.isRemote||s.playSoundAtEntity(c.getRef(),ModAPI.util.str("random.click"),1,1.8)}return e},ModAPI.items)return a();ModAPI.addEventListener("bootstrap",a)}},"./src/guns/Pistol.ts":(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=1,e=ModAPI.reflect.getClassByName("DamageSource"),n=ModAPI.reflect.getClassById("net.minecraft.creativetab.CreativeTabs").staticVariables.tabMisc,i=ModAPI.reflect.getClassById("net.minecraft.item.Item"),r=ModAPI.reflect.getSuper(i,(function(t){return 1===t.length})),o=function(){r(this),this.$setCreativeTab(n)};function a(){var t=(new o).$setUnlocalizedName(ModAPI.util.str("pistol")).$setMaxStackSize(1);return i.staticMethods.registerItem.method(ModAPI.keygen.item("pistol"),ModAPI.util.str("pistol"),t),ModAPI.items.pistol=t,t}if(ModAPI.addEventListener("update",(function(){ModAPI.player.rotationPitch-=t,t*=.7})),ModAPI.reflect.prototypeStack(i,o),o.prototype.$onItemRightClick=function(n,i,r){var o=e.staticVariables.cactus,a=ModAPI.util.wrap(i),s=ModAPI.util.wrap(r),c=function(t,e){for(var n=t.getPositionEyes(0),i=t.rayTrace(16,0).hitVec,r=e.getEntitiesWithinAABBExcludingEntity(t.getRef(),t.getEntityBoundingBox().expand(16,16,16).getRef()).getCorrective().array,o=null,a=!1,s=0,c=16,l=0;l<r.length;l++)if(r[l]){var u=r[l],d=u.getEntityBoundingBox().expand(.3,.3,.3).calculateIntercept(n.getRef(),i.getRef());if(null!=d){var f=n.distanceTo(d.hitVec.getRef());f<c&&(c=f,o=u,(a=u.getPositionEyes(0).distanceTo(d.hitVec.getRef())<.72)&&(s=1))}}return null!=o?{entity:o,headshot:a,intheadshot:s}:null}(s,a);return null!=c?a.isRemote?t+=4:(c.entity.attackEntityFrom(o,10+16*c.intheadshot),c.headshot&&console.log("H E A D S H O T"),a.playSoundAtEntity(s.getRef(),ModAPI.util.str("tile.piston.out"),1,1.8)):a.isRemote||a.playSoundAtEntity(s.getRef(),ModAPI.util.str("random.click"),1,1.8),n},ModAPI.items)return a();ModAPI.addEventListener("bootstrap",a)}},"./src/main.ts":function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n("./src/guns/Pistol.ts"),a=n("./src/guns/AssaultRifle.ts"),s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADySURBVFhH7ZQxDoMwDEVNr4G6VmJC6mk4Itdh7VpxjsBPDaKVCLZxypInIccg5zs/CVQoKAj8uHLjeETouo6HvlQcU3yJ932PIKkTceRAFH8NA6dE3IzbVogdQBOPtuVXfk5IJ8jWhKY4SxPaQvcmLEWuTUj/A1sqiEEcTQBENDWjvh3mvZtxccLiwMqvE0DrhNUBCCy1KSdAUsPiwFYcpM5ENrYWh3tdI4cT4dk0MSKPXzMSRSC+PMi14mcO4e7esv2iJqyHEGDVPCR6jyMC5luERXOfuoY7QFi8MKsDe6tXk8OBv7Ge/E96DZeKFwoOEE1wUX7TFh5zsgAAAABJRU5ErkJggg==";ModAPI.meta.title("Donut's Gun Mod"),ModAPI.meta.version("wIP"),ModAPI.meta.icon(s),ModAPI.meta.description("Requires AsyncSink. So far just skidded code from radman"),ModAPI.dedicatedServer.appendCode(o.default),ModAPI.dedicatedServer.appendCode(a.default);var c=(0,o.default)(),l=(0,a.default)();ModAPI.addEventListener("lib:asyncsink",(function(){return i(void 0,void 0,void 0,(function(){var t,e,n;return r(this,(function(i){switch(i.label){case 0:return ModAPI.addEventListener("custom:asyncsink_reloaded",(function(){ModAPI.mc.renderItem.registerItem(c,ModAPI.util.str("pistol")),ModAPI.mc.renderItem.registerItem(l,ModAPI.util.str("assaultrifle"))})),AsyncSink.L10N.set("item.pistol.name","Pistol"),AsyncSink.L10N.set("item.assaultrifle.name","Assault Rifle"),AsyncSink.setFile("resourcepacks/AsyncSinkLib/assets/minecraft/models/item/pistol.json",JSON.stringify({parent:"builtin/generated",textures:{layer0:"items/pistol"},display:{thirdperson:{rotation:[5,80,-45],translation:[0,1,-3],scale:[1,1,1]},firstperson:{rotation:[0,-135,25],translation:[0,4,2],scale:[1.8,1.8,1.8]}}})),e=(t=AsyncSink).setFile,n=["resourcepacks/AsyncSinkLib/assets/minecraft/textures/items/pistol.png"],[4,fetch(s)];case 1:return[4,i.sent().arrayBuffer()];case 2:return e.apply(t,n.concat([i.sent()])),[2]}}))}))}))}},e={};!function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}("./src/main.ts")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T2pMLFFBQVNpTCxFQUFRQSxFQUFPakwsUUFBUzZLLEdBR3BFSSxFQUFPakwsT0FDZixDQ25CMEI2SyxDQUFvQiIsInNvdXJjZXMiOlsid2VicGFjazovL2RvbnV0c2d1bnMvLi9zcmMvZ3Vucy9Bc3NhdWx0UmlmbGUudHMiLCJ3ZWJwYWNrOi8vZG9udXRzZ3Vucy8uL3NyYy9ndW5zL1Bpc3RvbC50cyIsIndlYnBhY2s6Ly9kb251dHNndW5zLy4vc3JjL21haW4udHMiLCJ3ZWJwYWNrOi8vZG9udXRzZ3Vucy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9kb251dHNndW5zL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGVmYXVsdCA9IEFzc2F1bHRSaWZsZTtcbmZ1bmN0aW9uIEFzc2F1bHRSaWZsZSgpIHtcbiAgICB2YXIgRGFtYWdlU291cmNlQ2xhc3MgPSBNb2RBUEkucmVmbGVjdC5nZXRDbGFzc0J5TmFtZShcIkRhbWFnZVNvdXJjZVwiKTtcbiAgICB2YXIgY3JlYXRpdmVNaXNjVGFiID0gTW9kQVBJLnJlZmxlY3QuZ2V0Q2xhc3NCeUlkKFwibmV0Lm1pbmVjcmFmdC5jcmVhdGl2ZXRhYi5DcmVhdGl2ZVRhYnNcIikuc3RhdGljVmFyaWFibGVzLnRhYk1pc2M7XG4gICAgdmFyIGl0ZW1DbGFzcyA9IE1vZEFQSS5yZWZsZWN0LmdldENsYXNzQnlJZChcIm5ldC5taW5lY3JhZnQuaXRlbS5JdGVtXCIpO1xuICAgIHZhciBpdGVtU3VwZXIgPSBNb2RBUEkucmVmbGVjdC5nZXRTdXBlcihpdGVtQ2xhc3MsIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4Lmxlbmd0aCA9PT0gMTsgfSk7XG4gICAgdmFyIG5taV9Bc3NhdWx0UmlmbGUgPSBmdW5jdGlvbiBubWlfQXNzYXVsdFJpZmxlKCkge1xuICAgICAgICBpdGVtU3VwZXIodGhpcyk7IC8vVXNlIHN1cGVyIGZ1bmN0aW9uIHRvIGdldCBibG9jayBwcm9wZXJ0aWVzIG9uIHRoaXMgY2xhc3MuXG4gICAgICAgIHRoaXMuJHNldENyZWF0aXZlVGFiKGNyZWF0aXZlTWlzY1RhYik7XG4gICAgfTtcbiAgICBmdW5jdGlvbiBlbnRpdHlSYXlDYXN0KHBsYXllciwgd29ybGQsIHJhbmdlKSB7XG4gICAgICAgIHZhciBIRUFEU0hPVF9NQVhfRElTVEFOQ0VfRlJPTV9IRUFEID0gMC43MjtcbiAgICAgICAgdmFyIGV5ZVBvc2l0aW9uID0gcGxheWVyLmdldFBvc2l0aW9uRXllcygwLjApO1xuICAgICAgICB2YXIgdGFyZ2V0UG9zaXRpb24gPSBwbGF5ZXIucmF5VHJhY2UocmFuZ2UsIDApLmhpdFZlYztcbiAgICAgICAgdmFyIGVudGl0aWVzID0gd29ybGQuZ2V0RW50aXRpZXNXaXRoaW5BQUJCRXhjbHVkaW5nRW50aXR5KHBsYXllci5nZXRSZWYoKSwgcGxheWVyLmdldEVudGl0eUJvdW5kaW5nQm94KCkuZXhwYW5kKHJhbmdlLCByYW5nZSwgcmFuZ2UpLmdldFJlZigpKS5nZXRDb3JyZWN0aXZlKCkuYXJyYXk7XG4gICAgICAgIHZhciBjbG9zZXN0RW50aXR5ID0gbnVsbDtcbiAgICAgICAgdmFyIGlzSGVhZHNob3QgPSBmYWxzZTtcbiAgICAgICAgdmFyIGlzSGVhZHNob3RJbnQgPSAwO1xuICAgICAgICB2YXIgY2xvc2VzdERpc3RhbmNlID0gcmFuZ2U7XG4gICAgICAgIC8vIFBhcnRpY2xlIGhhbmRsZXJcbiAgICAgICAgdmFyIGVudW1QYXJ0aWNsZVNtb2tlID0gTW9kQVBJLnJlZmxlY3QuZ2V0Q2xhc3NCeU5hbWUoXCJFbnVtUGFydGljbGVUeXBlc1wiKS5zdGF0aWNWYXJpYWJsZXMuU01PS0VfTk9STUFMO1xuICAgICAgICB2YXIgZXllTW9kID0gMS41O1xuICAgICAgICAvLyBQbGF5ZXIgcG9zaXRpb25cbiAgICAgICAgdmFyIHBsYXllclggPSBwbGF5ZXIucG9zWDtcbiAgICAgICAgdmFyIHBsYXllclkgPSBwbGF5ZXIucG9zWSArIGV5ZU1vZDtcbiAgICAgICAgdmFyIHBsYXllclogPSBwbGF5ZXIucG9zWjtcbiAgICAgICAgLy8gVGFyZ2V0IHBvc2l0aW9uXG4gICAgICAgIHZhciB0YXJnZXRYID0gdGFyZ2V0UG9zaXRpb24ueENvb3JkO1xuICAgICAgICB2YXIgdGFyZ2V0WSA9IHRhcmdldFBvc2l0aW9uLnlDb29yZDtcbiAgICAgICAgdmFyIHRhcmdldFogPSB0YXJnZXRQb3NpdGlvbi56Q29vcmQ7XG4gICAgICAgIC8vIENhbGN1bGF0ZSBkaXJlY3Rpb24gdmVjdG9yXG4gICAgICAgIHZhciBkaXJYID0gdGFyZ2V0WCAtIHBsYXllclg7XG4gICAgICAgIHZhciBkaXJZID0gdGFyZ2V0WSAtIHBsYXllclk7XG4gICAgICAgIHZhciBkaXJaID0gdGFyZ2V0WiAtIHBsYXllclo7XG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZGlzdGFuY2UgYmV0d2VlbiB0aGUgcGxheWVyIGFuZCB0aGUgdGFyZ2V0XG4gICAgICAgIHZhciBkaXN0YW5jZSA9IE1hdGguc3FydChkaXJYICogZGlyWCArIGRpclkgKiBkaXJZICsgZGlyWiAqIGRpclopO1xuICAgICAgICAvLyBOb3JtYWxpemUgdGhlIGRpcmVjdGlvbiB2ZWN0b3JcbiAgICAgICAgdmFyIHN0ZXBYID0gZGlyWCAvIGRpc3RhbmNlO1xuICAgICAgICB2YXIgc3RlcFkgPSBkaXJZIC8gZGlzdGFuY2U7XG4gICAgICAgIHZhciBzdGVwWiA9IGRpclogLyBkaXN0YW5jZTtcbiAgICAgICAgLy8gRGVmaW5lIHRoZSBudW1iZXIgb2YgcGFydGljbGVzIGFuZCB0aGUgc3RlcCBzaXplXG4gICAgICAgIHZhciBudW1QYXJ0aWNsZXMgPSA1MDtcbiAgICAgICAgdmFyIHN0ZXBTaXplID0gZGlzdGFuY2UgLyBudW1QYXJ0aWNsZXM7XG4gICAgICAgIC8vIFNwYXduIHBhcnRpY2xlcyBhbG9uZyB0aGUgbGluZVxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBudW1QYXJ0aWNsZXM7IGkrKykge1xuICAgICAgICAgICAgdmFyIHBvc1ggPSBwbGF5ZXJYICsgc3RlcFggKiBpICogc3RlcFNpemU7XG4gICAgICAgICAgICB2YXIgcG9zWSA9IHBsYXllclkgKyBzdGVwWSAqIGkgKiBzdGVwU2l6ZTtcbiAgICAgICAgICAgIHZhciBwb3NaID0gcGxheWVyWiArIHN0ZXBaICogaSAqIHN0ZXBTaXplO1xuICAgICAgICAgICAgd29ybGQuc3Bhd25QYXJ0aWNsZShlbnVtUGFydGljbGVTbW9rZSwgcG9zWCwgcG9zWSwgcG9zWiwgMCwgMCwgMCwgWzBdKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggYWxsIGVudGl0aWVzIHRvIGZpbmQgdGhlIG9uZSB0aGUgcGxheWVyIGlzIGxvb2tpbmcgYXRcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbnRpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKCFlbnRpdGllc1tpXSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGVudGl0eSA9IGVudGl0aWVzW2ldO1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGVudGl0eSdzIGJvdW5kaW5nIGJveCBpbnRlcnNlY3RzIHdpdGggdGhlIHBsYXllcidzIHJheVxuICAgICAgICAgICAgdmFyIGVudGl0eUJCID0gZW50aXR5LmdldEVudGl0eUJvdW5kaW5nQm94KCkuZXhwYW5kKDAuMywgMC4zLCAwLjMpO1xuICAgICAgICAgICAgdmFyIGludGVyY2VwdCA9IGVudGl0eUJCLmNhbGN1bGF0ZUludGVyY2VwdChleWVQb3NpdGlvbi5nZXRSZWYoKSwgdGFyZ2V0UG9zaXRpb24uZ2V0UmVmKCkpO1xuICAgICAgICAgICAgaWYgKGludGVyY2VwdCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlVG9FbnRpdHkgPSBleWVQb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyY2VwdC5oaXRWZWMuZ2V0UmVmKCkpO1xuICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZVRvRW50aXR5IDwgY2xvc2VzdERpc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsb3Nlc3REaXN0YW5jZSA9IGRpc3RhbmNlVG9FbnRpdHk7XG4gICAgICAgICAgICAgICAgICAgIGNsb3Nlc3RFbnRpdHkgPSBlbnRpdHk7XG4gICAgICAgICAgICAgICAgICAgIGlzSGVhZHNob3QgPSBlbnRpdHkuZ2V0UG9zaXRpb25FeWVzKDAuMCkuZGlzdGFuY2VUbyhpbnRlcmNlcHQuaGl0VmVjLmdldFJlZigpKSA8IEhFQURTSE9UX01BWF9ESVNUQU5DRV9GUk9NX0hFQUQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0hlYWRzaG90KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpc0hlYWRzaG90SW50ID0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgcmF5VHJhY2VSZXN1bHQgPSBjbG9zZXN0RW50aXR5O1xuICAgICAgICBpZiAocmF5VHJhY2VSZXN1bHQgIT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgZW50aXR5OiByYXlUcmFjZVJlc3VsdCwgaGVhZHNob3Q6IGlzSGVhZHNob3QsIGludGhlYWRzaG90OiBpc0hlYWRzaG90SW50IH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBNb2RBUEkucmVmbGVjdC5wcm90b3R5cGVTdGFjayhpdGVtQ2xhc3MsIG5taV9Bc3NhdWx0UmlmbGUpO1xuICAgIHZhciBoYXNTaG90ID0gZmFsc2U7XG4gICAgbm1pX0Fzc2F1bHRSaWZsZS5wcm90b3R5cGUuJG9uUGxheWVyU3RvcHBlZFVzaW5nID0gZnVuY3Rpb24gKCRpdGVtc3RhY2spIHtcbiAgICAgICAgaGFzU2hvdCA9IGZhbHNlO1xuICAgIH07XG4gICAgbm1pX0Fzc2F1bHRSaWZsZS5wcm90b3R5cGUuJG9uSXRlbVVzZUZpbmlzaCA9IGZ1bmN0aW9uICgkaXRlbXN0YWNrKSB7XG4gICAgICAgIHJldHVybiAkaXRlbXN0YWNrO1xuICAgIH07XG4gICAgbm1pX0Fzc2F1bHRSaWZsZS5wcm90b3R5cGUuJGdldE1heEl0ZW1Vc2VEdXJhdGlvbiA9IGZ1bmN0aW9uICgkaXRlbXN0YWNrKSB7XG4gICAgICAgIHJldHVybiA3MjAwMDtcbiAgICB9O1xuICAgIG5taV9Bc3NhdWx0UmlmbGUucHJvdG90eXBlLiRnZXRJdGVtVXNlQWN0aW9uID0gZnVuY3Rpb24gKCRpdGVtc3RhY2spIHtcbiAgICAgICAgLy9pbGwgYWRkIGFuIGVudW0gZm9yIEdVTiBsYXRlclxuICAgICAgICByZXR1cm4gTW9kQVBJLnJlZmxlY3QuZ2V0Q2xhc3NCeU5hbWUoXCJFbnVtQWN0aW9uXCIpLnN0YXRpY1ZhcmlhYmxlcy5EUklOSztcbiAgICB9O1xuICAgIG5taV9Bc3NhdWx0UmlmbGUucHJvdG90eXBlLiRvbkl0ZW1SaWdodENsaWNrID0gZnVuY3Rpb24gKCRpdGVtc3RhY2ssICR3b3JsZCwgJHBsYXllcikge1xuICAgICAgICBpZiAoIWhhc1Nob3QpIHtcbiAgICAgICAgICAgIGhhc1Nob3QgPSB0cnVlO1xuICAgICAgICAgICAgdmFyIGNhY3R1cyA9IERhbWFnZVNvdXJjZUNsYXNzLnN0YXRpY1ZhcmlhYmxlcy5jYWN0dXM7XG4gICAgICAgICAgICB2YXIgd29ybGQgPSBNb2RBUEkudXRpbC53cmFwKCR3b3JsZCk7XG4gICAgICAgICAgICB2YXIgZW50aXR5cGxheWVyID0gTW9kQVBJLnV0aWwud3JhcCgkcGxheWVyKTtcbiAgICAgICAgICAgIHZhciBzaG90ZW50aXR5ZGF0YSA9IGVudGl0eVJheUNhc3QoZW50aXR5cGxheWVyLCB3b3JsZCwgMzIuMCk7XG4gICAgICAgICAgICAvL2Jyb29vb29vb1xuICAgICAgICAgICAgLy9Nb2RBUEkubWluZWNyYWZ0LmZvbnRSZW5kZXJlck9iai5kcmF3U3RyaW5nKE1vZEFQSS51dGlsLnN0cihcImhlbGxvLCB3b3JsZCFcIiksIDEwLCAxMCwgMSk7XG4gICAgICAgICAgICBlbnRpdHlwbGF5ZXIuc2V0SXRlbUluVXNlKCRpdGVtc3RhY2ssIG5taV9Bc3NhdWx0UmlmbGUucHJvdG90eXBlLiRnZXRNYXhJdGVtVXNlRHVyYXRpb24oJGl0ZW1zdGFjaykpO1xuICAgICAgICAgICAgaWYgKHNob3RlbnRpdHlkYXRhICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAod29ybGQuaXNSZW1vdGUpIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNob3RlbnRpdHlkYXRhLmVudGl0eS5hdHRhY2tFbnRpdHlGcm9tKGNhY3R1cywgMTAgKyAoMTYgKiBzaG90ZW50aXR5ZGF0YS5pbnRoZWFkc2hvdCkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdGVudGl0eWRhdGEuaGVhZHNob3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSCBFIEEgRCBTIEggTyBUXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZEF0RW50aXR5KGVudGl0eXBsYXllci5nZXRSZWYoKSwgTW9kQVBJLnV0aWwuc3RyKFwidGlsZS5waXN0b24ub3V0XCIpLCAxLjAsIDEuOCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIXdvcmxkLmlzUmVtb3RlKSB7XG4gICAgICAgICAgICAgICAgd29ybGQucGxheVNvdW5kQXRFbnRpdHkoZW50aXR5cGxheWVyLmdldFJlZigpLCBNb2RBUEkudXRpbC5zdHIoXCJyYW5kb20uY2xpY2tcIiksIDEuMCwgMS44KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJGl0ZW1zdGFjaztcbiAgICB9O1xuICAgIGZ1bmN0aW9uIGludGVybmFsX3JlZygpIHtcbiAgICAgICAgdmFyIGFyX2l0ZW0gPSAobmV3IG5taV9Bc3NhdWx0UmlmbGUoKSkuJHNldFVubG9jYWxpemVkTmFtZShNb2RBUEkudXRpbC5zdHIoXCJhc3NhdWx0cmlmbGVcIikpLiRzZXRNYXhTdGFja1NpemUoMSk7XG4gICAgICAgIGl0ZW1DbGFzcy5zdGF0aWNNZXRob2RzLnJlZ2lzdGVySXRlbS5tZXRob2QoTW9kQVBJLmtleWdlbi5pdGVtKFwiYXNzYXVsdHJpZmxlXCIpLCBNb2RBUEkudXRpbC5zdHIoXCJhc3NhdWx0cmlmbGVcIiksIGFyX2l0ZW0pO1xuICAgICAgICBNb2RBUEkuaXRlbXNbXCJhc3NhdWx0cmlmbGVcIl0gPSBhcl9pdGVtO1xuICAgICAgICByZXR1cm4gYXJfaXRlbTtcbiAgICB9XG4gICAgaWYgKE1vZEFQSS5pdGVtcykge1xuICAgICAgICByZXR1cm4gaW50ZXJuYWxfcmVnKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBNb2RBUEkuYWRkRXZlbnRMaXN0ZW5lcihcImJvb3RzdHJhcFwiLCBpbnRlcm5hbF9yZWcpO1xuICAgIH1cbn1cbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gUGlzdG9sSXRlbTtcbmZ1bmN0aW9uIFBpc3RvbEl0ZW0oKSB7XG4gICAgdmFyIHJlY29pbFNwZWVkID0gMTsgLy9yZWNvaWwgY29udHJvbGxlclxuICAgIHZhciBEYW1hZ2VTb3VyY2VDbGFzcyA9IE1vZEFQSS5yZWZsZWN0LmdldENsYXNzQnlOYW1lKFwiRGFtYWdlU291cmNlXCIpO1xuICAgIHZhciBjcmVhdGl2ZU1pc2NUYWIgPSBNb2RBUEkucmVmbGVjdC5nZXRDbGFzc0J5SWQoXCJuZXQubWluZWNyYWZ0LmNyZWF0aXZldGFiLkNyZWF0aXZlVGFic1wiKS5zdGF0aWNWYXJpYWJsZXMudGFiTWlzYztcbiAgICB2YXIgaXRlbUNsYXNzID0gTW9kQVBJLnJlZmxlY3QuZ2V0Q2xhc3NCeUlkKFwibmV0Lm1pbmVjcmFmdC5pdGVtLkl0ZW1cIik7XG4gICAgdmFyIGl0ZW1TdXBlciA9IE1vZEFQSS5yZWZsZWN0LmdldFN1cGVyKGl0ZW1DbGFzcywgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHgubGVuZ3RoID09PSAxOyB9KTtcbiAgICB2YXIgbm1pX0l0ZW1QaXN0b2wgPSBmdW5jdGlvbiBubWlfSXRlbVBpc3RvbCgpIHtcbiAgICAgICAgaXRlbVN1cGVyKHRoaXMpOyAvL1VzZSBzdXBlciBmdW5jdGlvbiB0byBnZXQgYmxvY2sgcHJvcGVydGllcyBvbiB0aGlzIGNsYXNzLlxuICAgICAgICB0aGlzLiRzZXRDcmVhdGl2ZVRhYihjcmVhdGl2ZU1pc2NUYWIpO1xuICAgIH07XG4gICAgTW9kQVBJLmFkZEV2ZW50TGlzdGVuZXIoXCJ1cGRhdGVcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBNb2RBUEkucGxheWVyLnJvdGF0aW9uUGl0Y2ggLT0gcmVjb2lsU3BlZWQ7XG4gICAgICAgIHJlY29pbFNwZWVkICo9IDAuNztcbiAgICB9KTtcbiAgICBmdW5jdGlvbiBlbnRpdHlSYXlDYXN0KHBsYXllciwgd29ybGQsIHJhbmdlKSB7XG4gICAgICAgIHZhciBIRUFEU0hPVF9NQVhfRElTVEFOQ0VfRlJPTV9IRUFEID0gMC43MjtcbiAgICAgICAgdmFyIGV5ZVBvc2l0aW9uID0gcGxheWVyLmdldFBvc2l0aW9uRXllcygwLjApO1xuICAgICAgICB2YXIgdGFyZ2V0UG9zaXRpb24gPSBwbGF5ZXIucmF5VHJhY2UocmFuZ2UsIDApLmhpdFZlYztcbiAgICAgICAgdmFyIGVudGl0aWVzID0gd29ybGQuZ2V0RW50aXRpZXNXaXRoaW5BQUJCRXhjbHVkaW5nRW50aXR5KHBsYXllci5nZXRSZWYoKSwgcGxheWVyLmdldEVudGl0eUJvdW5kaW5nQm94KCkuZXhwYW5kKHJhbmdlLCByYW5nZSwgcmFuZ2UpLmdldFJlZigpKS5nZXRDb3JyZWN0aXZlKCkuYXJyYXk7XG4gICAgICAgIHZhciBjbG9zZXN0RW50aXR5ID0gbnVsbDtcbiAgICAgICAgdmFyIGlzSGVhZHNob3QgPSBmYWxzZTtcbiAgICAgICAgdmFyIGlzSGVhZHNob3RJbnQgPSAwO1xuICAgICAgICB2YXIgY2xvc2VzdERpc3RhbmNlID0gcmFuZ2U7XG4gICAgICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBhbGwgZW50aXRpZXMgdG8gZmluZCB0aGUgb25lIHRoZSBwbGF5ZXIgaXMgbG9va2luZyBhdFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVudGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoIWVudGl0aWVzW2ldKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZW50aXR5ID0gZW50aXRpZXNbaV07XG4gICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgZW50aXR5J3MgYm91bmRpbmcgYm94IGludGVyc2VjdHMgd2l0aCB0aGUgcGxheWVyJ3MgcmF5XG4gICAgICAgICAgICB2YXIgZW50aXR5QkIgPSBlbnRpdHkuZ2V0RW50aXR5Qm91bmRpbmdCb3goKS5leHBhbmQoMC4zLCAwLjMsIDAuMyk7XG4gICAgICAgICAgICB2YXIgaW50ZXJjZXB0ID0gZW50aXR5QkIuY2FsY3VsYXRlSW50ZXJjZXB0KGV5ZVBvc2l0aW9uLmdldFJlZigpLCB0YXJnZXRQb3NpdGlvbi5nZXRSZWYoKSk7XG4gICAgICAgICAgICBpZiAoaW50ZXJjZXB0ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSBleWVQb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyY2VwdC5oaXRWZWMuZ2V0UmVmKCkpO1xuICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IGNsb3Nlc3REaXN0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICBjbG9zZXN0RGlzdGFuY2UgPSBkaXN0YW5jZTtcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VzdEVudGl0eSA9IGVudGl0eTtcbiAgICAgICAgICAgICAgICAgICAgaXNIZWFkc2hvdCA9IGVudGl0eS5nZXRQb3NpdGlvbkV5ZXMoMC4wKS5kaXN0YW5jZVRvKGludGVyY2VwdC5oaXRWZWMuZ2V0UmVmKCkpIDwgSEVBRFNIT1RfTUFYX0RJU1RBTkNFX0ZST01fSEVBRDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzSGVhZHNob3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSGVhZHNob3RJbnQgPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciByYXlUcmFjZVJlc3VsdCA9IGNsb3Nlc3RFbnRpdHk7XG4gICAgICAgIGlmIChyYXlUcmFjZVJlc3VsdCAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbnRpdHk6IHJheVRyYWNlUmVzdWx0LCBoZWFkc2hvdDogaXNIZWFkc2hvdCwgaW50aGVhZHNob3Q6IGlzSGVhZHNob3RJbnQgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIE1vZEFQSS5yZWZsZWN0LnByb3RvdHlwZVN0YWNrKGl0ZW1DbGFzcywgbm1pX0l0ZW1QaXN0b2wpO1xuICAgIG5taV9JdGVtUGlzdG9sLnByb3RvdHlwZS4kb25JdGVtUmlnaHRDbGljayA9IGZ1bmN0aW9uICgkaXRlbXN0YWNrLCAkd29ybGQsICRwbGF5ZXIpIHtcbiAgICAgICAgdmFyIGNhY3R1cyA9IERhbWFnZVNvdXJjZUNsYXNzLnN0YXRpY1ZhcmlhYmxlcy5jYWN0dXM7XG4gICAgICAgIHZhciB3b3JsZCA9IE1vZEFQSS51dGlsLndyYXAoJHdvcmxkKTtcbiAgICAgICAgdmFyIGVudGl0eXBsYXllciA9IE1vZEFQSS51dGlsLndyYXAoJHBsYXllcik7XG4gICAgICAgIHZhciBzaG90ZW50aXR5ZGF0YSA9IGVudGl0eVJheUNhc3QoZW50aXR5cGxheWVyLCB3b3JsZCwgMTYuMCk7XG4gICAgICAgIGlmIChzaG90ZW50aXR5ZGF0YSAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAod29ybGQuaXNSZW1vdGUpIHtcbiAgICAgICAgICAgICAgICByZWNvaWxTcGVlZCArPSA0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2hvdGVudGl0eWRhdGEuZW50aXR5LmF0dGFja0VudGl0eUZyb20oY2FjdHVzLCAxMCArICgxNiAqIHNob3RlbnRpdHlkYXRhLmludGhlYWRzaG90KSk7XG4gICAgICAgICAgICAgICAgaWYgKHNob3RlbnRpdHlkYXRhLmhlYWRzaG90KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSCBFIEEgRCBTIEggTyBUXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB3b3JsZC5wbGF5U291bmRBdEVudGl0eShlbnRpdHlwbGF5ZXIuZ2V0UmVmKCksIE1vZEFQSS51dGlsLnN0cihcInRpbGUucGlzdG9uLm91dFwiKSwgMS4wLCAxLjgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCF3b3JsZC5pc1JlbW90ZSkge1xuICAgICAgICAgICAgd29ybGQucGxheVNvdW5kQXRFbnRpdHkoZW50aXR5cGxheWVyLmdldFJlZigpLCBNb2RBUEkudXRpbC5zdHIoXCJyYW5kb20uY2xpY2tcIiksIDEuMCwgMS44KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJGl0ZW1zdGFjaztcbiAgICB9O1xuICAgIGZ1bmN0aW9uIGludGVybmFsX3JlZygpIHtcbiAgICAgICAgdmFyIHBpc3RvbF9pdGVtID0gKG5ldyBubWlfSXRlbVBpc3RvbCgpKS4kc2V0VW5sb2NhbGl6ZWROYW1lKE1vZEFQSS51dGlsLnN0cihcInBpc3RvbFwiKSkuJHNldE1heFN0YWNrU2l6ZSgxKTtcbiAgICAgICAgaXRlbUNsYXNzLnN0YXRpY01ldGhvZHMucmVnaXN0ZXJJdGVtLm1ldGhvZChNb2RBUEkua2V5Z2VuLml0ZW0oXCJwaXN0b2xcIiksIE1vZEFQSS51dGlsLnN0cihcInBpc3RvbFwiKSwgcGlzdG9sX2l0ZW0pO1xuICAgICAgICBNb2RBUEkuaXRlbXNbXCJwaXN0b2xcIl0gPSBwaXN0b2xfaXRlbTtcbiAgICAgICAgcmV0dXJuIHBpc3RvbF9pdGVtO1xuICAgIH1cbiAgICBpZiAoTW9kQVBJLml0ZW1zKSB7XG4gICAgICAgIHJldHVybiBpbnRlcm5hbF9yZWcoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIE1vZEFQSS5hZGRFdmVudExpc3RlbmVyKFwiYm9vdHN0cmFwXCIsIGludGVybmFsX3JlZyk7XG4gICAgfVxufVxuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7XG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZyA9IE9iamVjdC5jcmVhdGUoKHR5cGVvZiBJdGVyYXRvciA9PT0gXCJmdW5jdGlvblwiID8gSXRlcmF0b3IgOiBPYmplY3QpLnByb3RvdHlwZSk7XG4gICAgcmV0dXJuIGcubmV4dCA9IHZlcmIoMCksIGdbXCJ0aHJvd1wiXSA9IHZlcmIoMSksIGdbXCJyZXR1cm5cIl0gPSB2ZXJiKDIpLCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pIHRyeSB7XG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcbiAgICB9XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIFBpc3RvbF8xID0gcmVxdWlyZShcIi4vZ3Vucy9QaXN0b2xcIik7XG52YXIgQXNzYXVsdFJpZmxlXzEgPSByZXF1aXJlKFwiLi9ndW5zL0Fzc2F1bHRSaWZsZVwiKTtcbnZhciBpdGVtVGV4dHVyZSA9IFwiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFDQUFBQUFnQ0FZQUFBQnplbnIwQUFBQUFYTlNSMElBcnM0YzZRQUFBQVJuUVUxQkFBQ3hqd3Y4WVFVQUFBQUpjRWhaY3dBQURzTUFBQTdEQWNkdnFHUUFBQUR5U1VSQlZGaEg3WlF4RG9Nd0RFVk5yNEc2Vm1KQzZtazRJdGRoN1ZweGpzQlBEYUtWQ0xaeHlwSW5JY2NnNXpzL0NWUW9LQWo4dUhMamVFVG91bzZIdmxRY1UzeUo5MzJQSUtrVGNlUkFGSDhOQTZkRTNJemJWb2dkUUJPUHR1VlhmazVJSjhqV2hLWTRTeFBhUXZjbUxFV3VUVWovQTFzcWlFRWNUUUJFTkRXanZoM212WnR4Y2NMaXdNcXZFMERyaE5VQkNDeTFLU2RBVXNQaXdGWWNwTTVFTnJZV2gzdGRJNGNUNGRrME1TS1BYek1TUlNDK1BNaTE0bWNPNGU3ZXN2MmlKcXlIRUdEVlBDUjZqeU1DNWx1RVJYT2Z1b1k3UUZpOE1Lc0RlNnRYazhPQnY3R2UvRTk2RFplS0Z3b09FRTF3VVg3VEZoNXpzZ0FBQUFCSlJVNUVya0pnZ2c9PVwiO1xuTW9kQVBJLm1ldGEudGl0bGUoXCJEb251dCdzIEd1biBNb2RcIik7XG5Nb2RBUEkubWV0YS52ZXJzaW9uKFwid0lQXCIpO1xuTW9kQVBJLm1ldGEuaWNvbihpdGVtVGV4dHVyZSk7XG5Nb2RBUEkubWV0YS5kZXNjcmlwdGlvbihcIlJlcXVpcmVzIEFzeW5jU2luay4gU28gZmFyIGp1c3Qgc2tpZGRlZCBjb2RlIGZyb20gcmFkbWFuXCIpO1xuTW9kQVBJLmRlZGljYXRlZFNlcnZlci5hcHBlbmRDb2RlKFBpc3RvbF8xLmRlZmF1bHQpO1xuTW9kQVBJLmRlZGljYXRlZFNlcnZlci5hcHBlbmRDb2RlKEFzc2F1bHRSaWZsZV8xLmRlZmF1bHQpO1xudmFyIHBpc3RvbF9pdGVtID0gKDAsIFBpc3RvbF8xLmRlZmF1bHQpKCk7XG52YXIgYXJfaXRlbSA9ICgwLCBBc3NhdWx0UmlmbGVfMS5kZWZhdWx0KSgpO1xuTW9kQVBJLmFkZEV2ZW50TGlzdGVuZXIoXCJsaWI6YXN5bmNzaW5rXCIsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfZCkge1xuICAgICAgICBzd2l0Y2ggKF9kLmxhYmVsKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgTW9kQVBJLmFkZEV2ZW50TGlzdGVuZXIoXCJjdXN0b206YXN5bmNzaW5rX3JlbG9hZGVkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgTW9kQVBJLm1jLnJlbmRlckl0ZW0ucmVnaXN0ZXJJdGVtKHBpc3RvbF9pdGVtLCBNb2RBUEkudXRpbC5zdHIoXCJwaXN0b2xcIikpO1xuICAgICAgICAgICAgICAgICAgICBNb2RBUEkubWMucmVuZGVySXRlbS5yZWdpc3Rlckl0ZW0oYXJfaXRlbSwgTW9kQVBJLnV0aWwuc3RyKFwiYXNzYXVsdHJpZmxlXCIpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBBc3luY1NpbmsuTDEwTi5zZXQoXCJpdGVtLnBpc3RvbC5uYW1lXCIsIFwiUGlzdG9sXCIpO1xuICAgICAgICAgICAgICAgIEFzeW5jU2luay5MMTBOLnNldChcIml0ZW0uYXNzYXVsdHJpZmxlLm5hbWVcIiwgXCJBc3NhdWx0IFJpZmxlXCIpO1xuICAgICAgICAgICAgICAgIEFzeW5jU2luay5zZXRGaWxlKFwicmVzb3VyY2VwYWNrcy9Bc3luY1NpbmtMaWIvYXNzZXRzL21pbmVjcmFmdC9tb2RlbHMvaXRlbS9waXN0b2wuanNvblwiLCBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIFwicGFyZW50XCI6IFwiYnVpbHRpbi9nZW5lcmF0ZWRcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ0ZXh0dXJlc1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImxheWVyMFwiOiBcIml0ZW1zL3Bpc3RvbFwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFwiZGlzcGxheVwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInRoaXJkcGVyc29uXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJvdGF0aW9uXCI6IFs1LCA4MCwgLTQ1XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRyYW5zbGF0aW9uXCI6IFswLCAxLCAtM10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzY2FsZVwiOiBbMS4wLCAxLjAsIDEuMF1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcImZpcnN0cGVyc29uXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJvdGF0aW9uXCI6IFswLCAtMTM1LCAyNV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmFuc2xhdGlvblwiOiBbMCwgNCwgMl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzY2FsZVwiOiBbMS44LCAxLjgsIDEuOF1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBfYiA9IChfYSA9IEFzeW5jU2luaykuc2V0RmlsZTtcbiAgICAgICAgICAgICAgICBfYyA9IFtcInJlc291cmNlcGFja3MvQXN5bmNTaW5rTGliL2Fzc2V0cy9taW5lY3JhZnQvdGV4dHVyZXMvaXRlbXMvcGlzdG9sLnBuZ1wiXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBmZXRjaChpdGVtVGV4dHVyZSldO1xuICAgICAgICAgICAgY2FzZSAxOiByZXR1cm4gWzQgLyp5aWVsZCovLCAoX2Quc2VudCgpKS5hcnJheUJ1ZmZlcigpXTtcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICBfYi5hcHBseShfYSwgX2MuY29uY2F0KFtfZC5zZW50KCldKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICB9XG4gICAgfSk7XG59KTsgfSk7XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKFwiLi9zcmMvbWFpbi50c1wiKTtcbiJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIkRhbWFnZVNvdXJjZUNsYXNzIiwiTW9kQVBJIiwicmVmbGVjdCIsImdldENsYXNzQnlOYW1lIiwiY3JlYXRpdmVNaXNjVGFiIiwiZ2V0Q2xhc3NCeUlkIiwic3RhdGljVmFyaWFibGVzIiwidGFiTWlzYyIsIml0ZW1DbGFzcyIsIml0ZW1TdXBlciIsImdldFN1cGVyIiwieCIsImxlbmd0aCIsIm5taV9Bc3NhdWx0UmlmbGUiLCJ0aGlzIiwiJHNldENyZWF0aXZlVGFiIiwicHJvdG90eXBlU3RhY2siLCJoYXNTaG90IiwiaW50ZXJuYWxfcmVnIiwiYXJfaXRlbSIsIiRzZXRVbmxvY2FsaXplZE5hbWUiLCJ1dGlsIiwic3RyIiwiJHNldE1heFN0YWNrU2l6ZSIsInN0YXRpY01ldGhvZHMiLCJyZWdpc3Rlckl0ZW0iLCJtZXRob2QiLCJrZXlnZW4iLCJpdGVtIiwiaXRlbXMiLCJwcm90b3R5cGUiLCIkb25QbGF5ZXJTdG9wcGVkVXNpbmciLCIkaXRlbXN0YWNrIiwiJG9uSXRlbVVzZUZpbmlzaCIsIiRnZXRNYXhJdGVtVXNlRHVyYXRpb24iLCIkZ2V0SXRlbVVzZUFjdGlvbiIsIkRSSU5LIiwiJG9uSXRlbVJpZ2h0Q2xpY2siLCIkd29ybGQiLCIkcGxheWVyIiwiY2FjdHVzIiwid29ybGQiLCJ3cmFwIiwiZW50aXR5cGxheWVyIiwic2hvdGVudGl0eWRhdGEiLCJwbGF5ZXIiLCJleWVQb3NpdGlvbiIsImdldFBvc2l0aW9uRXllcyIsInRhcmdldFBvc2l0aW9uIiwicmF5VHJhY2UiLCJoaXRWZWMiLCJlbnRpdGllcyIsImdldEVudGl0aWVzV2l0aGluQUFCQkV4Y2x1ZGluZ0VudGl0eSIsImdldFJlZiIsImdldEVudGl0eUJvdW5kaW5nQm94IiwiZXhwYW5kIiwiZ2V0Q29ycmVjdGl2ZSIsImFycmF5IiwiY2xvc2VzdEVudGl0eSIsImlzSGVhZHNob3QiLCJpc0hlYWRzaG90SW50IiwiY2xvc2VzdERpc3RhbmNlIiwiZW51bVBhcnRpY2xlU21va2UiLCJTTU9LRV9OT1JNQUwiLCJwbGF5ZXJYIiwicG9zWCIsInBsYXllclkiLCJwb3NZIiwicGxheWVyWiIsInBvc1oiLCJkaXJYIiwieENvb3JkIiwiZGlyWSIsInlDb29yZCIsImRpcloiLCJ6Q29vcmQiLCJkaXN0YW5jZSIsIk1hdGgiLCJzcXJ0Iiwic3RlcFgiLCJzdGVwWSIsInN0ZXBaIiwic3RlcFNpemUiLCJpIiwic3Bhd25QYXJ0aWNsZSIsImVudGl0eSIsImludGVyY2VwdCIsImNhbGN1bGF0ZUludGVyY2VwdCIsImRpc3RhbmNlVG9FbnRpdHkiLCJkaXN0YW5jZVRvIiwiaGVhZHNob3QiLCJpbnRoZWFkc2hvdCIsImVudGl0eVJheUNhc3QiLCJzZXRJdGVtSW5Vc2UiLCJpc1JlbW90ZSIsImF0dGFja0VudGl0eUZyb20iLCJjb25zb2xlIiwibG9nIiwicGxheVNvdW5kQXRFbnRpdHkiLCJhZGRFdmVudExpc3RlbmVyIiwicmVjb2lsU3BlZWQiLCJubWlfSXRlbVBpc3RvbCIsInBpc3RvbF9pdGVtIiwicm90YXRpb25QaXRjaCIsIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiX19nZW5lcmF0b3IiLCJib2R5IiwiZiIsInkiLCJ0IiwiXyIsImxhYmVsIiwic2VudCIsInRyeXMiLCJvcHMiLCJnIiwiY3JlYXRlIiwiSXRlcmF0b3IiLCJ2ZXJiIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJuIiwidiIsIm9wIiwiVHlwZUVycm9yIiwiY2FsbCIsInBvcCIsInB1c2giLCJQaXN0b2xfMSIsIkFzc2F1bHRSaWZsZV8xIiwiaXRlbVRleHR1cmUiLCJtZXRhIiwidGl0bGUiLCJ2ZXJzaW9uIiwiaWNvbiIsImRlc2NyaXB0aW9uIiwiZGVkaWNhdGVkU2VydmVyIiwiYXBwZW5kQ29kZSIsImRlZmF1bHQiLCJfYSIsIl9iIiwiX2MiLCJfZCIsIm1jIiwicmVuZGVySXRlbSIsIkFzeW5jU2luayIsIkwxME4iLCJzZXQiLCJzZXRGaWxlIiwiSlNPTiIsInN0cmluZ2lmeSIsImZldGNoIiwiYXJyYXlCdWZmZXIiLCJjb25jYXQiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIl0sInNvdXJjZVJvb3QiOiIifQ==