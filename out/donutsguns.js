/*! For license information please see donutsguns.js.LICENSE.txt */
(()=>{"use strict";var t={"./src/guns/AssaultRifle.ts":(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=ModAPI.reflect.getClassByName("DamageSource"),e=ModAPI.reflect.getClassById("net.minecraft.creativetab.CreativeTabs").staticVariables.tabMisc,n=ModAPI.reflect.getClassById("net.minecraft.item.Item"),i=ModAPI.reflect.getSuper(n,(function(t){return 1===t.length})),r=function(){i(this),this.$setCreativeTab(e)};ModAPI.addEventListener("update",(function(){})),ModAPI.reflect.prototypeStack(n,r);var o=!1;function a(){var t=(new r).$setUnlocalizedName(ModAPI.util.str("assaultrifle")).$setMaxStackSize(1);return n.staticMethods.registerItem.method(ModAPI.keygen.item("assaultrifle"),ModAPI.util.str("assaultrifle"),t),ModAPI.items.assaultrifle=t,t}if(r.prototype.$onPlayerStoppedUsing=function(t){o=!1},r.prototype.$onItemUseFinish=function(t){return t},r.prototype.$getMaxItemUseDuration=function(t){return 72e3},r.prototype.$getItemUseAction=function(t){return ModAPI.reflect.getClassByName("EnumAction").staticVariables.DRINK},r.prototype.$onItemRightClick=function(e,n,i){if(!o){o=!0;var a=t.staticVariables.cactus,s=ModAPI.util.wrap(n),c=ModAPI.util.wrap(i),l=function(t,e){for(var n=t.getPositionEyes(0),i=t.rayTrace(32,0).hitVec,r=e.getEntitiesWithinAABBExcludingEntity(t.getRef(),t.getEntityBoundingBox().expand(32,32,32).getRef()).getCorrective().array,o=null,a=!1,s=0,c=32,l=ModAPI.reflect.getClassByName("EnumParticleTypes").staticVariables.SMOKE_NORMAL,u=t.posX,d=t.posY+1.5,f=t.posZ,A=i.xCoord-u,p=i.yCoord-d,y=i.zCoord-f,g=Math.sqrt(A*A+p*p+y*y),I=A/g,m=p/g,h=y/g,M=g/75,P=0;P<=75;P++){var v=u+I*P*M,E=d+m*P*M,b=f+h*P*M;e.spawnParticle(l,v,E,b,0,0,0,[0])}for(P=0;P<r.length;P++)if(r[P]){var S=r[P],R=S.getEntityBoundingBox().expand(.3,.3,.3).calculateIntercept(n.getRef(),i.getRef());if(null!=R){var k=n.distanceTo(R.hitVec.getRef());k<c&&(c=k,o=S,(a=S.getPositionEyes(0).distanceTo(R.hitVec.getRef())<.72)&&(s=1))}}return null!=o?{entity:o,headshot:a,intheadshot:s}:null}(c,s);c.setItemInUse(e,r.prototype.$getMaxItemUseDuration(e)),null!=l?s.isRemote||(l.entity.attackEntityFrom(a,10+16*l.intheadshot),l.headshot&&console.log("H E A D S H O T"),s.playSoundAtEntity(c.getRef(),ModAPI.util.str("tile.piston.out"),1,1.8)):s.isRemote||s.playSoundAtEntity(c.getRef(),ModAPI.util.str("random.click"),1,1.8)}return e},ModAPI.items)return a();ModAPI.addEventListener("bootstrap",a)}},"./src/guns/Pistol.ts":(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=1,e=ModAPI.reflect.getClassByName("DamageSource"),n=ModAPI.reflect.getClassById("net.minecraft.creativetab.CreativeTabs").staticVariables.tabMisc,i=ModAPI.reflect.getClassById("net.minecraft.item.Item"),r=ModAPI.reflect.getSuper(i,(function(t){return 1===t.length})),o=function(){r(this),this.$setCreativeTab(n)};function a(){var t=(new o).$setUnlocalizedName(ModAPI.util.str("pistol")).$setMaxStackSize(1);return i.staticMethods.registerItem.method(ModAPI.keygen.item("pistol"),ModAPI.util.str("pistol"),t),ModAPI.items.pistol=t,t}if(ModAPI.addEventListener("update",(function(){ModAPI.player.rotationPitch-=t,t*=.7})),ModAPI.reflect.prototypeStack(i,o),o.prototype.$onItemRightClick=function(n,i,r){var o=e.staticVariables.cactus,a=ModAPI.util.wrap(i),s=ModAPI.util.wrap(r),c=function(t,e){for(var n=t.getPositionEyes(0),i=t.rayTrace(16,0).hitVec,r=e.getEntitiesWithinAABBExcludingEntity(t.getRef(),t.getEntityBoundingBox().expand(16,16,16).getRef()).getCorrective().array,o=null,a=!1,s=0,c=16,l=0;l<r.length;l++)if(r[l]){var u=r[l],d=u.getEntityBoundingBox().expand(.3,.3,.3).calculateIntercept(n.getRef(),i.getRef());if(null!=d){var f=n.distanceTo(d.hitVec.getRef());f<c&&(c=f,o=u,(a=u.getPositionEyes(0).distanceTo(d.hitVec.getRef())<.72)&&(s=1))}}return null!=o?{entity:o,headshot:a,intheadshot:s}:null}(s,a);return null!=c?a.isRemote?t+=4:(c.entity.attackEntityFrom(o,10+16*c.intheadshot),c.headshot&&console.log("H E A D S H O T"),a.playSoundAtEntity(s.getRef(),ModAPI.util.str("tile.piston.out"),1,1.8)):a.isRemote||a.playSoundAtEntity(s.getRef(),ModAPI.util.str("random.click"),1,1.8),n},ModAPI.items)return a();ModAPI.addEventListener("bootstrap",a)}},"./src/main.ts":function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n("./src/guns/Pistol.ts"),a=n("./src/guns/AssaultRifle.ts"),s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADySURBVFhH7ZQxDoMwDEVNr4G6VmJC6mk4Itdh7VpxjsBPDaKVCLZxypInIccg5zs/CVQoKAj8uHLjeETouo6HvlQcU3yJ932PIKkTceRAFH8NA6dE3IzbVogdQBOPtuVXfk5IJ8jWhKY4SxPaQvcmLEWuTUj/A1sqiEEcTQBENDWjvh3mvZtxccLiwMqvE0DrhNUBCCy1KSdAUsPiwFYcpM5ENrYWh3tdI4cT4dk0MSKPXzMSRSC+PMi14mcO4e7esv2iJqyHEGDVPCR6jyMC5luERXOfuoY7QFi8MKsDe6tXk8OBv7Ge/E96DZeKFwoOEE1wUX7TFh5zsgAAAABJRU5ErkJggg==";ModAPI.meta.title("Donut's Gun Mod"),ModAPI.meta.version("wIP"),ModAPI.meta.icon(s),ModAPI.meta.description("Requires AsyncSink. So far just skidded code from radman"),ModAPI.dedicatedServer.appendCode(o.default),ModAPI.dedicatedServer.appendCode(a.default);var c=(0,o.default)(),l=(0,a.default)();ModAPI.addEventListener("lib:asyncsink",(function(){return i(void 0,void 0,void 0,(function(){var t,e,n;return r(this,(function(i){switch(i.label){case 0:return ModAPI.addEventListener("custom:asyncsink_reloaded",(function(){ModAPI.mc.renderItem.registerItem(c,ModAPI.util.str("pistol")),ModAPI.mc.renderItem.registerItem(l,ModAPI.util.str("assaultrifle"))})),AsyncSink.L10N.set("item.pistol.name","Pistol"),AsyncSink.L10N.set("item.assaultrifle.name","Assault Rifle"),AsyncSink.setFile("resourcepacks/AsyncSinkLib/assets/minecraft/models/item/pistol.json",JSON.stringify({parent:"builtin/generated",textures:{layer0:"items/pistol"},display:{thirdperson:{rotation:[5,80,-45],translation:[0,1,-3],scale:[1,1,1]},firstperson:{rotation:[0,-135,25],translation:[0,4,2],scale:[1.8,1.8,1.8]}}})),e=(t=AsyncSink).setFile,n=["resourcepacks/AsyncSinkLib/assets/minecraft/textures/items/pistol.png"],[4,fetch(s)];case 1:return[4,i.sent().arrayBuffer()];case 2:return e.apply(t,n.concat([i.sent()])),[2]}}))}))}))}},e={};!function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}("./src/main.ts")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9udXRzZ3Vucy5qcyIsIm1hcHBpbmdzIjoiOytEQUNBQSxPQUFPQyxlQUFlQyxFQUFTLGFBQWMsQ0FBRUMsT0FBTyxJQUN0REQsRUFBQSxRQUNBLFdBQ0ksSUFDSUUsRUFBb0JDLE9BQU9DLFFBQVFDLGVBQWUsZ0JBQ2xEQyxFQUFrQkgsT0FBT0MsUUFBUUcsYUFBYSwwQ0FBMENDLGdCQUFnQkMsUUFDeEdDLEVBQVlQLE9BQU9DLFFBQVFHLGFBQWEsMkJBQ3hDSSxFQUFZUixPQUFPQyxRQUFRUSxTQUFTRixHQUFXLFNBQVVHLEdBQUssT0FBb0IsSUFBYkEsRUFBRUMsTUFBYyxJQUNyRkMsRUFBbUIsV0FDbkJKLEVBQVVLLE1BQ1ZBLEtBQUtDLGdCQUFnQlgsRUFDekIsRUFDQUgsT0FBT2UsaUJBQWlCLFVBQVUsV0FFbEMsSUEwRUFmLE9BQU9DLFFBQVFlLGVBQWVULEVBQVdLLEdBQ3pDLElBQUlLLEdBQVUsRUEwQ2QsU0FBU0MsSUFDTCxJQUFJQyxHQUFVLElBQUtQLEdBQW9CUSxvQkFBb0JwQixPQUFPcUIsS0FBS0MsSUFBSSxpQkFBaUJDLGlCQUFpQixHQUc3RyxPQUZBaEIsRUFBVWlCLGNBQWNDLGFBQWFDLE9BQU8xQixPQUFPMkIsT0FBT0MsS0FBSyxnQkFBaUI1QixPQUFPcUIsS0FBS0MsSUFBSSxnQkFBaUJILEdBQ2pIbkIsT0FBTzZCLE1BQW9CLGFBQUlWLEVBQ3hCQSxDQUNYLENBQ0EsR0EvQ0FQLEVBQWlCa0IsVUFBVUMsc0JBQXdCLFNBQVVDLEdBQ3pEZixHQUFVLENBQ2QsRUFDQUwsRUFBaUJrQixVQUFVRyxpQkFBbUIsU0FBVUQsR0FDcEQsT0FBT0EsQ0FDWCxFQUNBcEIsRUFBaUJrQixVQUFVSSx1QkFBeUIsU0FBVUYsR0FDMUQsT0FBTyxJQUNYLEVBQ0FwQixFQUFpQmtCLFVBQVVLLGtCQUFvQixTQUFVSCxHQUVyRCxPQUFPaEMsT0FBT0MsUUFBUUMsZUFBZSxjQUFjRyxnQkFBZ0IrQixLQUN2RSxFQUNBeEIsRUFBaUJrQixVQUFVTyxrQkFBb0IsU0FBVUwsRUFBWU0sRUFBUUMsR0FDekUsSUFBS3RCLEVBQVMsQ0FDVkEsR0FBVSxFQUNWLElBQUl1QixFQUFTekMsRUFBa0JNLGdCQUFnQm1DLE9BQzNDQyxFQUFRekMsT0FBT3FCLEtBQUtxQixLQUFLSixHQUN6QkssRUFBZTNDLE9BQU9xQixLQUFLcUIsS0FBS0gsR0FDaENLLEVBOUZaLFNBQXVCQyxFQUFRSixHQWtDM0IsSUFqQ0EsSUFDSUssRUFBY0QsRUFBT0UsZ0JBQWdCLEdBQ3JDQyxFQUFpQkgsRUFBT0ksU0EyRmdDLEdBM0ZoQixHQUFHQyxPQUMzQ0MsRUFBV1YsRUFBTVcscUNBQXFDUCxFQUFPUSxTQUFVUixFQUFPUyx1QkFBdUJDLE9BMEY3QyxVQTFGeUVGLFVBQVVHLGdCQUFnQkMsTUFDM0pDLEVBQWdCLEtBQ2hCQyxHQUFhLEVBQ2JDLEVBQWdCLEVBQ2hCQyxFQXNGd0QsR0FwRnhEQyxFQUFvQjlELE9BQU9DLFFBQVFDLGVBQWUscUJBQXFCRyxnQkFBZ0IwRCxhQUd2RkMsRUFBVW5CLEVBQU9vQixLQUNqQkMsRUFBVXJCLEVBQU9zQixLQUhSLElBSVRDLEVBQVV2QixFQUFPd0IsS0FNakJDLEVBSlV0QixFQUFldUIsT0FJUlAsRUFDakJRLEVBSlV4QixFQUFleUIsT0FJUlAsRUFDakJRLEVBSlUxQixFQUFlMkIsT0FJUlAsRUFFakJRLEVBQVdDLEtBQUtDLEtBQUtSLEVBQU9BLEVBQU9FLEVBQU9BLEVBQU9FLEVBQU9BLEdBRXhESyxFQUFRVCxFQUFPTSxFQUNmSSxFQUFRUixFQUFPSSxFQUNmSyxFQUFRUCxFQUFPRSxFQUdmTSxFQUFXTixFQURJLEdBR1ZPLEVBQUksRUFBR0EsR0FIRyxHQUdnQkEsSUFBSyxDQUNwQyxJQUFJbEIsRUFBT0QsRUFBVWUsRUFBUUksRUFBSUQsRUFDN0JmLEVBQU9ELEVBQVVjLEVBQVFHLEVBQUlELEVBQzdCYixFQUFPRCxFQUFVYSxFQUFRRSxFQUFJRCxFQUNqQ3pDLEVBQU0yQyxjQUFjdEIsRUFBbUJHLEVBQU1FLEVBQU1FLEVBQU0sRUFBRyxFQUFHLEVBQUcsQ0FBQyxHQUN2RSxDQU1BLElBQVNjLEVBQUksRUFBR0EsRUFBSWhDLEVBQVN4QyxPQUFRd0UsSUFDakMsR0FBS2hDLEVBQVNnQyxHQUFkLENBR0EsSUFBSUUsRUFBU2xDLEVBQVNnQyxHQUdsQkcsRUFEV0QsRUFBTy9CLHVCQUF1QkMsT0FBTyxHQUFLLEdBQUssSUFDckNnQyxtQkFBbUJ6QyxFQUFZTyxTQUFVTCxFQUFlSyxVQUNqRixHQUFpQixNQUFiaUMsRUFBbUIsQ0FDbkIsSUFBSUUsRUFBbUIxQyxFQUFZMkMsV0FBV0gsRUFBVXBDLE9BQU9HLFVBQzNEbUMsRUFBbUIzQixJQUNuQkEsRUFBa0IyQixFQUNsQjlCLEVBQWdCMkIsR0FDaEIxQixFQUFhMEIsRUFBT3RDLGdCQUFnQixHQUFLMEMsV0FBV0gsRUFBVXBDLE9BQU9HLFVBekQzQyxPQTJEdEJPLEVBQWdCLEdBRzVCLENBZkEsQ0FrQkosT0FBc0IsTUFEREYsRUFFVixDQUFFMkIsT0FGUTNCLEVBRWdCZ0MsU0FBVS9CLEVBQVlnQyxZQUFhL0IsR0FHN0QsSUFFZixDQXNCNkJnQyxDQUFjakQsRUFBY0YsR0FHakRFLEVBQWFrRCxhQUFhN0QsRUFBWXBCLEVBQWlCa0IsVUFBVUksdUJBQXVCRixJQUNsRSxNQUFsQlksRUFDSUgsRUFBTXFELFdBSU5sRCxFQUFleUMsT0FBT1UsaUJBQWlCdkQsRUFBUSxHQUFNLEdBQUtJLEVBQWUrQyxhQUNyRS9DLEVBQWU4QyxVQUNmTSxRQUFRQyxJQUFJLG1CQUVoQnhELEVBQU15RCxrQkFBa0J2RCxFQUFhVSxTQUFVckQsT0FBT3FCLEtBQUtDLElBQUksbUJBQW9CLEVBQUssTUFHdEZtQixFQUFNcUQsVUFDWnJELEVBQU15RCxrQkFBa0J2RCxFQUFhVSxTQUFVckQsT0FBT3FCLEtBQUtDLElBQUksZ0JBQWlCLEVBQUssSUFFN0YsQ0FDQSxPQUFPVSxDQUNYLEVBT0loQyxPQUFPNkIsTUFDUCxPQUFPWCxJQUdQbEIsT0FBT2UsaUJBQWlCLFlBQWFHLEVBRTdDLGtDQy9JQXZCLE9BQU9DLGVBQWVDLEVBQVMsYUFBYyxDQUFFQyxPQUFPLElBQ3RERCxFQUFBLFFBQ0EsV0FDSSxJQUFJc0csRUFBYyxFQUNkcEcsRUFBb0JDLE9BQU9DLFFBQVFDLGVBQWUsZ0JBQ2xEQyxFQUFrQkgsT0FBT0MsUUFBUUcsYUFBYSwwQ0FBMENDLGdCQUFnQkMsUUFDeEdDLEVBQVlQLE9BQU9DLFFBQVFHLGFBQWEsMkJBQ3hDSSxFQUFZUixPQUFPQyxRQUFRUSxTQUFTRixHQUFXLFNBQVVHLEdBQUssT0FBb0IsSUFBYkEsRUFBRUMsTUFBYyxJQUNyRnlGLEVBQWlCLFdBQ2pCNUYsRUFBVUssTUFDVkEsS0FBS0MsZ0JBQWdCWCxFQUN6QixFQWtFQSxTQUFTZSxJQUNMLElBQUltRixHQUFjLElBQUtELEdBQWtCaEYsb0JBQW9CcEIsT0FBT3FCLEtBQUtDLElBQUksV0FBV0MsaUJBQWlCLEdBR3pHLE9BRkFoQixFQUFVaUIsY0FBY0MsYUFBYUMsT0FBTzFCLE9BQU8yQixPQUFPQyxLQUFLLFVBQVc1QixPQUFPcUIsS0FBS0MsSUFBSSxVQUFXK0UsR0FDckdyRyxPQUFPNkIsTUFBYyxPQUFJd0UsRUFDbEJBLENBQ1gsQ0FDQSxHQXZFQXJHLE9BQU9lLGlCQUFpQixVQUFVLFdBQzlCZixPQUFPNkMsT0FBT3lELGVBQWlCSCxFQUMvQkEsR0FBZSxFQUNuQixJQXVDQW5HLE9BQU9DLFFBQVFlLGVBQWVULEVBQVc2RixHQUN6Q0EsRUFBZXRFLFVBQVVPLGtCQUFvQixTQUFVTCxFQUFZTSxFQUFRQyxHQUN2RSxJQUFJQyxFQUFTekMsRUFBa0JNLGdCQUFnQm1DLE9BQzNDQyxFQUFRekMsT0FBT3FCLEtBQUtxQixLQUFLSixHQUN6QkssRUFBZTNDLE9BQU9xQixLQUFLcUIsS0FBS0gsR0FDaENLLEVBM0NSLFNBQXVCQyxFQUFRSixHQVUzQixJQVRBLElBQ0lLLEVBQWNELEVBQU9FLGdCQUFnQixHQUNyQ0MsRUFBaUJILEVBQU9JLFNBd0M0QixHQXhDWixHQUFHQyxPQUMzQ0MsRUFBV1YsRUFBTVcscUNBQXFDUCxFQUFPUSxTQUFVUixFQUFPUyx1QkFBdUJDLE9BdUNqRCxVQXZDNkVGLFVBQVVHLGdCQUFnQkMsTUFDM0pDLEVBQWdCLEtBQ2hCQyxHQUFhLEVBQ2JDLEVBQWdCLEVBQ2hCQyxFQW1Db0QsR0FqQy9Dc0IsRUFBSSxFQUFHQSxFQUFJaEMsRUFBU3hDLE9BQVF3RSxJQUNqQyxHQUFLaEMsRUFBU2dDLEdBQWQsQ0FHQSxJQUFJRSxFQUFTbEMsRUFBU2dDLEdBR2xCRyxFQURXRCxFQUFPL0IsdUJBQXVCQyxPQUFPLEdBQUssR0FBSyxJQUNyQ2dDLG1CQUFtQnpDLEVBQVlPLFNBQVVMLEVBQWVLLFVBQ2pGLEdBQWlCLE1BQWJpQyxFQUFtQixDQUNuQixJQUFJVixFQUFXOUIsRUFBWTJDLFdBQVdILEVBQVVwQyxPQUFPRyxVQUNuRHVCLEVBQVdmLElBQ1hBLEVBQWtCZSxFQUNsQmxCLEVBQWdCMkIsR0FDaEIxQixFQUFhMEIsRUFBT3RDLGdCQUFnQixHQUFLMEMsV0FBV0gsRUFBVXBDLE9BQU9HLFVBdEIzQyxPQXdCdEJPLEVBQWdCLEdBRzVCLENBZkEsQ0FrQkosT0FBc0IsTUFEREYsRUFFVixDQUFFMkIsT0FGUTNCLEVBRWdCZ0MsU0FBVS9CLEVBQVlnQyxZQUFhL0IsR0FHN0QsSUFFZixDQU15QmdDLENBQWNqRCxFQUFjRixHQWdCakQsT0Fmc0IsTUFBbEJHLEVBQ0lILEVBQU1xRCxTQUNOSyxHQUFlLEdBR2Z2RCxFQUFleUMsT0FBT1UsaUJBQWlCdkQsRUFBUSxHQUFNLEdBQUtJLEVBQWUrQyxhQUNyRS9DLEVBQWU4QyxVQUNmTSxRQUFRQyxJQUFJLG1CQUVoQnhELEVBQU15RCxrQkFBa0J2RCxFQUFhVSxTQUFVckQsT0FBT3FCLEtBQUtDLElBQUksbUJBQW9CLEVBQUssTUFHdEZtQixFQUFNcUQsVUFDWnJELEVBQU15RCxrQkFBa0J2RCxFQUFhVSxTQUFVckQsT0FBT3FCLEtBQUtDLElBQUksZ0JBQWlCLEVBQUssS0FFbEZVLENBQ1gsRUFPSWhDLE9BQU82QixNQUNQLE9BQU9YLElBR1BsQixPQUFPZSxpQkFBaUIsWUFBYUcsRUFFN0MsbUNDekZBLElBQUlxRixFQUFhMUYsTUFBUUEsS0FBSzBGLFdBQWMsU0FBVUMsRUFBU0MsRUFBWUMsRUFBR0MsR0FFMUUsT0FBTyxJQUFLRCxJQUFNQSxFQUFJRSxXQUFVLFNBQVVDLEVBQVNDLEdBQy9DLFNBQVNDLEVBQVVqSCxHQUFTLElBQU1rSCxFQUFLTCxFQUFVTSxLQUFLbkgsR0FBUyxDQUFFLE1BQU9vSCxHQUFLSixFQUFPSSxFQUFJLENBQUUsQ0FDMUYsU0FBU0MsRUFBU3JILEdBQVMsSUFBTWtILEVBQUtMLEVBQWlCLE1BQUU3RyxHQUFTLENBQUUsTUFBT29ILEdBQUtKLEVBQU9JLEVBQUksQ0FBRSxDQUM3RixTQUFTRixFQUFLSSxHQUpsQixJQUFldEgsRUFJYXNILEVBQU9DLEtBQU9SLEVBQVFPLEVBQU90SCxRQUoxQ0EsRUFJeURzSCxFQUFPdEgsTUFKaERBLGFBQWlCNEcsRUFBSTVHLEVBQVEsSUFBSTRHLEdBQUUsU0FBVUcsR0FBV0EsRUFBUS9HLEVBQVEsS0FJakJ3SCxLQUFLUCxFQUFXSSxFQUFXLENBQzdHSCxHQUFNTCxFQUFZQSxFQUFVWSxNQUFNZixFQUFTQyxHQUFjLEtBQUtRLE9BQ2xFLEdBQ0osRUFDSU8sRUFBZTNHLE1BQVFBLEtBQUsyRyxhQUFnQixTQUFVaEIsRUFBU2lCLEdBQy9ELElBQXNHQyxFQUFHQyxFQUFHQyxFQUF4R0MsRUFBSSxDQUFFQyxNQUFPLEVBQUdDLEtBQU0sV0FBYSxHQUFXLEVBQVBILEVBQUUsR0FBUSxNQUFNQSxFQUFFLEdBQUksT0FBT0EsRUFBRSxFQUFJLEVBQUdJLEtBQU0sR0FBSUMsSUFBSyxJQUFlQyxFQUFJdkksT0FBT3dJLFFBQTRCLG1CQUFiQyxTQUEwQkEsU0FBV3pJLFFBQVFtQyxXQUN0TCxPQUFPb0csRUFBRWpCLEtBQU9vQixFQUFLLEdBQUlILEVBQVMsTUFBSUcsRUFBSyxHQUFJSCxFQUFVLE9BQUlHLEVBQUssR0FBc0IsbUJBQVhDLFNBQTBCSixFQUFFSSxPQUFPQyxVQUFZLFdBQWEsT0FBTzFILElBQU0sR0FBSXFILEVBQzFKLFNBQVNHLEVBQUtHLEdBQUssT0FBTyxTQUFVQyxHQUFLLE9BQ3pDLFNBQWNDLEdBQ1YsR0FBSWhCLEVBQUcsTUFBTSxJQUFJaUIsVUFBVSxtQ0FDM0IsS0FBT1QsSUFBTUEsRUFBSSxFQUFHUSxFQUFHLEtBQU9iLEVBQUksSUFBS0EsT0FDbkMsR0FBSUgsRUFBSSxFQUFHQyxJQUFNQyxFQUFZLEVBQVJjLEVBQUcsR0FBU2YsRUFBVSxPQUFJZSxFQUFHLEdBQUtmLEVBQVMsU0FBT0MsRUFBSUQsRUFBVSxTQUFNQyxFQUFFZ0IsS0FBS2pCLEdBQUksR0FBS0EsRUFBRVYsU0FBV1csRUFBSUEsRUFBRWdCLEtBQUtqQixFQUFHZSxFQUFHLEtBQUtyQixLQUFNLE9BQU9PLEVBRTNKLE9BRElELEVBQUksRUFBR0MsSUFBR2MsRUFBSyxDQUFTLEVBQVJBLEVBQUcsR0FBUWQsRUFBRTlILFFBQ3pCNEksRUFBRyxJQUNQLEtBQUssRUFBRyxLQUFLLEVBQUdkLEVBQUljLEVBQUksTUFDeEIsS0FBSyxFQUFjLE9BQVhiLEVBQUVDLFFBQWdCLENBQUVoSSxNQUFPNEksRUFBRyxHQUFJckIsTUFBTSxHQUNoRCxLQUFLLEVBQUdRLEVBQUVDLFFBQVNILEVBQUllLEVBQUcsR0FBSUEsRUFBSyxDQUFDLEdBQUksU0FDeEMsS0FBSyxFQUFHQSxFQUFLYixFQUFFSSxJQUFJWSxNQUFPaEIsRUFBRUcsS0FBS2EsTUFBTyxTQUN4QyxRQUNJLE1BQWtCakIsR0FBWkEsRUFBSUMsRUFBRUcsTUFBWXJILE9BQVMsR0FBS2lILEVBQUVBLEVBQUVqSCxPQUFTLEtBQWtCLElBQVYrSCxFQUFHLElBQXNCLElBQVZBLEVBQUcsSUFBVyxDQUFFYixFQUFJLEVBQUcsUUFBVSxDQUMzRyxHQUFjLElBQVZhLEVBQUcsTUFBY2QsR0FBTWMsRUFBRyxHQUFLZCxFQUFFLElBQU1jLEVBQUcsR0FBS2QsRUFBRSxJQUFNLENBQUVDLEVBQUVDLE1BQVFZLEVBQUcsR0FBSSxLQUFPLENBQ3JGLEdBQWMsSUFBVkEsRUFBRyxJQUFZYixFQUFFQyxNQUFRRixFQUFFLEdBQUksQ0FBRUMsRUFBRUMsTUFBUUYsRUFBRSxHQUFJQSxFQUFJYyxFQUFJLEtBQU8sQ0FDcEUsR0FBSWQsR0FBS0MsRUFBRUMsTUFBUUYsRUFBRSxHQUFJLENBQUVDLEVBQUVDLE1BQVFGLEVBQUUsR0FBSUMsRUFBRUksSUFBSWEsS0FBS0osR0FBSyxLQUFPLENBQzlEZCxFQUFFLElBQUlDLEVBQUVJLElBQUlZLE1BQ2hCaEIsRUFBRUcsS0FBS2EsTUFBTyxTQUV0QkgsRUFBS2pCLEVBQUttQixLQUFLcEMsRUFBU3FCLEVBQzVCLENBQUUsTUFBT1gsR0FBS3dCLEVBQUssQ0FBQyxFQUFHeEIsR0FBSVMsRUFBSSxDQUFHLENBQUUsUUFBVUQsRUFBSUUsRUFBSSxDQUFHLENBQ3pELEdBQVksRUFBUmMsRUFBRyxHQUFRLE1BQU1BLEVBQUcsR0FBSSxNQUFPLENBQUU1SSxNQUFPNEksRUFBRyxHQUFLQSxFQUFHLFFBQUssRUFBUXJCLE1BQU0sRUFDOUUsQ0F0QmdETCxDQUFLLENBQUN3QixFQUFHQyxHQUFLLENBQUcsQ0F1QnJFLEVBQ0E5SSxPQUFPQyxlQUFlQyxFQUFTLGFBQWMsQ0FBRUMsT0FBTyxJQUN0RCxJQUFJaUosRUFBVyxFQUFRLHdCQUNuQkMsRUFBaUIsRUFBUSw4QkFDekJDLEVBQWMsNmVBQ2xCakosT0FBT2tKLEtBQUtDLE1BQU0sbUJBQ2xCbkosT0FBT2tKLEtBQUtFLFFBQVEsT0FDcEJwSixPQUFPa0osS0FBS0csS0FBS0osR0FDakJqSixPQUFPa0osS0FBS0ksWUFBWSw0REFDeEJ0SixPQUFPdUosZ0JBQWdCQyxXQUFXVCxFQUFTVSxTQUMzQ3pKLE9BQU91SixnQkFBZ0JDLFdBQVdSLEVBQWVTLFNBQ2pELElBQUlwRCxHQUFjLEVBQUkwQyxFQUFTVSxXQUMzQnRJLEdBQVUsRUFBSTZILEVBQWVTLFdBQ2pDekosT0FBT2UsaUJBQWlCLGlCQUFpQixXQUFjLE9BQU93RixPQUFVLE9BQVEsT0FBUSxHQUFRLFdBQzVGLElBQUltRCxFQUFJQyxFQUFJQyxFQUNaLE9BQU9wQyxFQUFZM0csTUFBTSxTQUFVZ0osR0FDL0IsT0FBUUEsRUFBRy9CLE9BQ1AsS0FBSyxFQTJCRCxPQTFCQTlILE9BQU9lLGlCQUFpQiw2QkFBNkIsV0FDakRmLE9BQU84SixHQUFHQyxXQUFXdEksYUFBYTRFLEVBQWFyRyxPQUFPcUIsS0FBS0MsSUFBSSxXQUMvRHRCLE9BQU84SixHQUFHQyxXQUFXdEksYUFBYU4sRUFBU25CLE9BQU9xQixLQUFLQyxJQUFJLGdCQUMvRCxJQUNBMEksVUFBVUMsS0FBS0MsSUFBSSxtQkFBb0IsVUFDdkNGLFVBQVVDLEtBQUtDLElBQUkseUJBQTBCLGlCQUM3Q0YsVUFBVUcsUUFBUSxzRUFBdUVDLEtBQUtDLFVBQVUsQ0FDcEcsT0FBVSxvQkFDVixTQUFZLENBQ1IsT0FBVSxnQkFFZCxRQUFXLENBQ1AsWUFBZSxDQUNYLFNBQVksQ0FBQyxFQUFHLElBQUssSUFDckIsWUFBZSxDQUFDLEVBQUcsR0FBSSxHQUN2QixNQUFTLENBQUMsRUFBSyxFQUFLLElBRXhCLFlBQWUsQ0FDWCxTQUFZLENBQUMsR0FBSSxJQUFLLElBQ3RCLFlBQWUsQ0FBQyxFQUFHLEVBQUcsR0FDdEIsTUFBUyxDQUFDLElBQUssSUFBSyxVQUloQ1YsR0FBTUQsRUFBS00sV0FBV0csUUFDdEJQLEVBQUssQ0FBQyx5RUFDQyxDQUFDLEVBQWFVLE1BQU1yQixJQUMvQixLQUFLLEVBQUcsTUFBTyxDQUFDLEVBQWNZLEVBQUc5QixPQUFRd0MsZUFDekMsS0FBSyxFQUVELE9BREFaLEVBQUdwQyxNQUFNbUMsRUFBSUUsRUFBR1ksT0FBTyxDQUFDWCxFQUFHOUIsVUFDcEIsQ0FBQyxHQUVwQixHQUNKLEdBQUksTUN0RkEwQyxFQUEyQixDQUFDLEdBR2hDLFNBQVNDLEVBQW9CQyxHQUU1QixJQUFJQyxFQUFlSCxFQUF5QkUsR0FDNUMsUUFBcUJFLElBQWpCRCxFQUNILE9BQU9BLEVBQWEvSyxRQUdyQixJQUFJaUwsRUFBU0wsRUFBeUJFLEdBQVksQ0FHakQ5SyxRQUFTLENBQUMsR0FPWCxPQUhBa0wsRUFBb0JKLEdBQVUvQixLQUFLa0MsRUFBT2pMLFFBQVNpTCxFQUFRQSxFQUFPakwsUUFBUzZLLEdBR3BFSSxFQUFPakwsT0FDZixDQ25CMEI2SyxDQUFvQiIsInNvdXJjZXMiOlsid2VicGFjazovL2RvbnV0c2d1bnMvLi9zcmMvZ3Vucy9Bc3NhdWx0UmlmbGUudHMiLCJ3ZWJwYWNrOi8vZG9udXRzZ3Vucy8uL3NyYy9ndW5zL1Bpc3RvbC50cyIsIndlYnBhY2s6Ly9kb251dHNndW5zLy4vc3JjL21haW4udHMiLCJ3ZWJwYWNrOi8vZG9udXRzZ3Vucy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9kb251dHNndW5zL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGVmYXVsdCA9IEFzc2F1bHRSaWZsZTtcbmZ1bmN0aW9uIEFzc2F1bHRSaWZsZSgpIHtcbiAgICB2YXIgcmVjb2lsU3BlZWQgPSAxOyAvL3JlY29pbCBjb250cm9sbGVyXG4gICAgdmFyIERhbWFnZVNvdXJjZUNsYXNzID0gTW9kQVBJLnJlZmxlY3QuZ2V0Q2xhc3NCeU5hbWUoXCJEYW1hZ2VTb3VyY2VcIik7XG4gICAgdmFyIGNyZWF0aXZlTWlzY1RhYiA9IE1vZEFQSS5yZWZsZWN0LmdldENsYXNzQnlJZChcIm5ldC5taW5lY3JhZnQuY3JlYXRpdmV0YWIuQ3JlYXRpdmVUYWJzXCIpLnN0YXRpY1ZhcmlhYmxlcy50YWJNaXNjO1xuICAgIHZhciBpdGVtQ2xhc3MgPSBNb2RBUEkucmVmbGVjdC5nZXRDbGFzc0J5SWQoXCJuZXQubWluZWNyYWZ0Lml0ZW0uSXRlbVwiKTtcbiAgICB2YXIgaXRlbVN1cGVyID0gTW9kQVBJLnJlZmxlY3QuZ2V0U3VwZXIoaXRlbUNsYXNzLCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5sZW5ndGggPT09IDE7IH0pO1xuICAgIHZhciBubWlfQXNzYXVsdFJpZmxlID0gZnVuY3Rpb24gbm1pX0Fzc2F1bHRSaWZsZSgpIHtcbiAgICAgICAgaXRlbVN1cGVyKHRoaXMpOyAvL1VzZSBzdXBlciBmdW5jdGlvbiB0byBnZXQgYmxvY2sgcHJvcGVydGllcyBvbiB0aGlzIGNsYXNzLlxuICAgICAgICB0aGlzLiRzZXRDcmVhdGl2ZVRhYihjcmVhdGl2ZU1pc2NUYWIpO1xuICAgIH07XG4gICAgTW9kQVBJLmFkZEV2ZW50TGlzdGVuZXIoXCJ1cGRhdGVcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZWNvaWxTcGVlZCAqPSAwLjc7XG4gICAgfSk7XG4gICAgZnVuY3Rpb24gZW50aXR5UmF5Q2FzdChwbGF5ZXIsIHdvcmxkLCByYW5nZSkge1xuICAgICAgICB2YXIgSEVBRFNIT1RfTUFYX0RJU1RBTkNFX0ZST01fSEVBRCA9IDAuNzI7XG4gICAgICAgIHZhciBleWVQb3NpdGlvbiA9IHBsYXllci5nZXRQb3NpdGlvbkV5ZXMoMC4wKTtcbiAgICAgICAgdmFyIHRhcmdldFBvc2l0aW9uID0gcGxheWVyLnJheVRyYWNlKHJhbmdlLCAwKS5oaXRWZWM7XG4gICAgICAgIHZhciBlbnRpdGllcyA9IHdvcmxkLmdldEVudGl0aWVzV2l0aGluQUFCQkV4Y2x1ZGluZ0VudGl0eShwbGF5ZXIuZ2V0UmVmKCksIHBsYXllci5nZXRFbnRpdHlCb3VuZGluZ0JveCgpLmV4cGFuZChyYW5nZSwgcmFuZ2UsIHJhbmdlKS5nZXRSZWYoKSkuZ2V0Q29ycmVjdGl2ZSgpLmFycmF5O1xuICAgICAgICB2YXIgY2xvc2VzdEVudGl0eSA9IG51bGw7XG4gICAgICAgIHZhciBpc0hlYWRzaG90ID0gZmFsc2U7XG4gICAgICAgIHZhciBpc0hlYWRzaG90SW50ID0gMDtcbiAgICAgICAgdmFyIGNsb3Nlc3REaXN0YW5jZSA9IHJhbmdlO1xuICAgICAgICAvLyBQYXJ0aWNsZSBoYW5kbGVyXG4gICAgICAgIHZhciBlbnVtUGFydGljbGVTbW9rZSA9IE1vZEFQSS5yZWZsZWN0LmdldENsYXNzQnlOYW1lKFwiRW51bVBhcnRpY2xlVHlwZXNcIikuc3RhdGljVmFyaWFibGVzLlNNT0tFX05PUk1BTDtcbiAgICAgICAgdmFyIGV5ZU1vZCA9IDEuNTtcbiAgICAgICAgLy8gUGxheWVyIHBvc2l0aW9uXG4gICAgICAgIHZhciBwbGF5ZXJYID0gcGxheWVyLnBvc1g7XG4gICAgICAgIHZhciBwbGF5ZXJZID0gcGxheWVyLnBvc1kgKyBleWVNb2Q7XG4gICAgICAgIHZhciBwbGF5ZXJaID0gcGxheWVyLnBvc1o7XG4gICAgICAgIC8vIFRhcmdldCBwb3NpdGlvblxuICAgICAgICB2YXIgdGFyZ2V0WCA9IHRhcmdldFBvc2l0aW9uLnhDb29yZDtcbiAgICAgICAgdmFyIHRhcmdldFkgPSB0YXJnZXRQb3NpdGlvbi55Q29vcmQ7XG4gICAgICAgIHZhciB0YXJnZXRaID0gdGFyZ2V0UG9zaXRpb24uekNvb3JkO1xuICAgICAgICAvLyBDYWxjdWxhdGUgZGlyZWN0aW9uIHZlY3RvclxuICAgICAgICB2YXIgZGlyWCA9IHRhcmdldFggLSBwbGF5ZXJYO1xuICAgICAgICB2YXIgZGlyWSA9IHRhcmdldFkgLSBwbGF5ZXJZO1xuICAgICAgICB2YXIgZGlyWiA9IHRhcmdldFogLSBwbGF5ZXJaO1xuICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGRpc3RhbmNlIGJldHdlZW4gdGhlIHBsYXllciBhbmQgdGhlIHRhcmdldFxuICAgICAgICB2YXIgZGlzdGFuY2UgPSBNYXRoLnNxcnQoZGlyWCAqIGRpclggKyBkaXJZICogZGlyWSArIGRpclogKiBkaXJaKTtcbiAgICAgICAgLy8gTm9ybWFsaXplIHRoZSBkaXJlY3Rpb24gdmVjdG9yXG4gICAgICAgIHZhciBzdGVwWCA9IGRpclggLyBkaXN0YW5jZTtcbiAgICAgICAgdmFyIHN0ZXBZID0gZGlyWSAvIGRpc3RhbmNlO1xuICAgICAgICB2YXIgc3RlcFogPSBkaXJaIC8gZGlzdGFuY2U7XG4gICAgICAgIC8vIERlZmluZSB0aGUgbnVtYmVyIG9mIHBhcnRpY2xlcyBhbmQgdGhlIHN0ZXAgc2l6ZVxuICAgICAgICB2YXIgbnVtUGFydGljbGVzID0gNzU7XG4gICAgICAgIHZhciBzdGVwU2l6ZSA9IGRpc3RhbmNlIC8gbnVtUGFydGljbGVzO1xuICAgICAgICAvLyBTcGF3biBwYXJ0aWNsZXMgYWxvbmcgdGhlIGxpbmVcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gbnVtUGFydGljbGVzOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBwb3NYID0gcGxheWVyWCArIHN0ZXBYICogaSAqIHN0ZXBTaXplO1xuICAgICAgICAgICAgdmFyIHBvc1kgPSBwbGF5ZXJZICsgc3RlcFkgKiBpICogc3RlcFNpemU7XG4gICAgICAgICAgICB2YXIgcG9zWiA9IHBsYXllclogKyBzdGVwWiAqIGkgKiBzdGVwU2l6ZTtcbiAgICAgICAgICAgIHdvcmxkLnNwYXduUGFydGljbGUoZW51bVBhcnRpY2xlU21va2UsIHBvc1gsIHBvc1ksIHBvc1osIDAsIDAsIDAsIFswXSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gd29ybGQuc3Bhd25QYXJ0aWNsZShlbnVtUGFydGljbGVTbW9rZSwgcGxheWVyLnBvc1gsIHBsYXllci5wb3NZICsgZXllTW9kLCBwbGF5ZXIucG9zWiwgMCwgMCwgMCwgWzBdKTtcbiAgICAgICAgLy8gd29ybGQuc3Bhd25QYXJ0aWNsZShlbnVtUGFydGljbGVTbW9rZSwgcGxheWVyLnBvc1gsIHBsYXllci5wb3NZICsgZXllTW9kLCBwbGF5ZXIucG9zWiwgMCwgMCwgMCwgWzBdKTtcbiAgICAgICAgLy8gd29ybGQuc3Bhd25QYXJ0aWNsZShlbnVtUGFydGljbGVTbW9rZSwgdGFyZ2V0UG9zaXRpb24ueENvb3JkLCB0YXJnZXRQb3NpdGlvbi55Q29vcmQsIHRhcmdldFBvc2l0aW9uLnpDb29yZCwgMCwgMCwgMCwgWzBdKTtcbiAgICAgICAgLy8gd29ybGQuc3Bhd25QYXJ0aWNsZShlbnVtUGFydGljbGVTbW9rZSwgdGFyZ2V0UG9zaXRpb24ueENvb3JkLCB0YXJnZXRQb3NpdGlvbi55Q29vcmQsIHRhcmdldFBvc2l0aW9uLnpDb29yZCwgMCwgMCwgMCwgWzBdKTtcbiAgICAgICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCBlbnRpdGllcyB0byBmaW5kIHRoZSBvbmUgdGhlIHBsYXllciBpcyBsb29raW5nIGF0XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZW50aXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICghZW50aXRpZXNbaV0pIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBlbnRpdHkgPSBlbnRpdGllc1tpXTtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBlbnRpdHkncyBib3VuZGluZyBib3ggaW50ZXJzZWN0cyB3aXRoIHRoZSBwbGF5ZXIncyByYXlcbiAgICAgICAgICAgIHZhciBlbnRpdHlCQiA9IGVudGl0eS5nZXRFbnRpdHlCb3VuZGluZ0JveCgpLmV4cGFuZCgwLjMsIDAuMywgMC4zKTtcbiAgICAgICAgICAgIHZhciBpbnRlcmNlcHQgPSBlbnRpdHlCQi5jYWxjdWxhdGVJbnRlcmNlcHQoZXllUG9zaXRpb24uZ2V0UmVmKCksIHRhcmdldFBvc2l0aW9uLmdldFJlZigpKTtcbiAgICAgICAgICAgIGlmIChpbnRlcmNlcHQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBkaXN0YW5jZVRvRW50aXR5ID0gZXllUG9zaXRpb24uZGlzdGFuY2VUbyhpbnRlcmNlcHQuaGl0VmVjLmdldFJlZigpKTtcbiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2VUb0VudGl0eSA8IGNsb3Nlc3REaXN0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICBjbG9zZXN0RGlzdGFuY2UgPSBkaXN0YW5jZVRvRW50aXR5O1xuICAgICAgICAgICAgICAgICAgICBjbG9zZXN0RW50aXR5ID0gZW50aXR5O1xuICAgICAgICAgICAgICAgICAgICBpc0hlYWRzaG90ID0gZW50aXR5LmdldFBvc2l0aW9uRXllcygwLjApLmRpc3RhbmNlVG8oaW50ZXJjZXB0LmhpdFZlYy5nZXRSZWYoKSkgPCBIRUFEU0hPVF9NQVhfRElTVEFOQ0VfRlJPTV9IRUFEO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNIZWFkc2hvdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNIZWFkc2hvdEludCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJheVRyYWNlUmVzdWx0ID0gY2xvc2VzdEVudGl0eTtcbiAgICAgICAgaWYgKHJheVRyYWNlUmVzdWx0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVudGl0eTogcmF5VHJhY2VSZXN1bHQsIGhlYWRzaG90OiBpc0hlYWRzaG90LCBpbnRoZWFkc2hvdDogaXNIZWFkc2hvdEludCB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgTW9kQVBJLnJlZmxlY3QucHJvdG90eXBlU3RhY2soaXRlbUNsYXNzLCBubWlfQXNzYXVsdFJpZmxlKTtcbiAgICB2YXIgaGFzU2hvdCA9IGZhbHNlO1xuICAgIG5taV9Bc3NhdWx0UmlmbGUucHJvdG90eXBlLiRvblBsYXllclN0b3BwZWRVc2luZyA9IGZ1bmN0aW9uICgkaXRlbXN0YWNrKSB7XG4gICAgICAgIGhhc1Nob3QgPSBmYWxzZTtcbiAgICB9O1xuICAgIG5taV9Bc3NhdWx0UmlmbGUucHJvdG90eXBlLiRvbkl0ZW1Vc2VGaW5pc2ggPSBmdW5jdGlvbiAoJGl0ZW1zdGFjaykge1xuICAgICAgICByZXR1cm4gJGl0ZW1zdGFjaztcbiAgICB9O1xuICAgIG5taV9Bc3NhdWx0UmlmbGUucHJvdG90eXBlLiRnZXRNYXhJdGVtVXNlRHVyYXRpb24gPSBmdW5jdGlvbiAoJGl0ZW1zdGFjaykge1xuICAgICAgICByZXR1cm4gNzIwMDA7XG4gICAgfTtcbiAgICBubWlfQXNzYXVsdFJpZmxlLnByb3RvdHlwZS4kZ2V0SXRlbVVzZUFjdGlvbiA9IGZ1bmN0aW9uICgkaXRlbXN0YWNrKSB7XG4gICAgICAgIC8vaWxsIGFkZCBhbiBlbnVtIGZvciBHVU4gbGF0ZXJcbiAgICAgICAgcmV0dXJuIE1vZEFQSS5yZWZsZWN0LmdldENsYXNzQnlOYW1lKFwiRW51bUFjdGlvblwiKS5zdGF0aWNWYXJpYWJsZXMuRFJJTks7XG4gICAgfTtcbiAgICBubWlfQXNzYXVsdFJpZmxlLnByb3RvdHlwZS4kb25JdGVtUmlnaHRDbGljayA9IGZ1bmN0aW9uICgkaXRlbXN0YWNrLCAkd29ybGQsICRwbGF5ZXIpIHtcbiAgICAgICAgaWYgKCFoYXNTaG90KSB7XG4gICAgICAgICAgICBoYXNTaG90ID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBjYWN0dXMgPSBEYW1hZ2VTb3VyY2VDbGFzcy5zdGF0aWNWYXJpYWJsZXMuY2FjdHVzO1xuICAgICAgICAgICAgdmFyIHdvcmxkID0gTW9kQVBJLnV0aWwud3JhcCgkd29ybGQpO1xuICAgICAgICAgICAgdmFyIGVudGl0eXBsYXllciA9IE1vZEFQSS51dGlsLndyYXAoJHBsYXllcik7XG4gICAgICAgICAgICB2YXIgc2hvdGVudGl0eWRhdGEgPSBlbnRpdHlSYXlDYXN0KGVudGl0eXBsYXllciwgd29ybGQsIDMyLjApO1xuICAgICAgICAgICAgLy9icm9vb29vb29cbiAgICAgICAgICAgIC8vTW9kQVBJLm1pbmVjcmFmdC5mb250UmVuZGVyZXJPYmouZHJhd1N0cmluZyhNb2RBUEkudXRpbC5zdHIoXCJoZWxsbywgd29ybGQhXCIpLCAxMCwgMTAsIDEpO1xuICAgICAgICAgICAgZW50aXR5cGxheWVyLnNldEl0ZW1JblVzZSgkaXRlbXN0YWNrLCBubWlfQXNzYXVsdFJpZmxlLnByb3RvdHlwZS4kZ2V0TWF4SXRlbVVzZUR1cmF0aW9uKCRpdGVtc3RhY2spKTtcbiAgICAgICAgICAgIGlmIChzaG90ZW50aXR5ZGF0YSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdvcmxkLmlzUmVtb3RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlY29pbFNwZWVkICs9IDQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzaG90ZW50aXR5ZGF0YS5lbnRpdHkuYXR0YWNrRW50aXR5RnJvbShjYWN0dXMsIDEwICsgKDE2ICogc2hvdGVudGl0eWRhdGEuaW50aGVhZHNob3QpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNob3RlbnRpdHlkYXRhLmhlYWRzaG90KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkggRSBBIEQgUyBIIE8gVFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB3b3JsZC5wbGF5U291bmRBdEVudGl0eShlbnRpdHlwbGF5ZXIuZ2V0UmVmKCksIE1vZEFQSS51dGlsLnN0cihcInRpbGUucGlzdG9uLm91dFwiKSwgMS4wLCAxLjgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCF3b3JsZC5pc1JlbW90ZSkge1xuICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZEF0RW50aXR5KGVudGl0eXBsYXllci5nZXRSZWYoKSwgTW9kQVBJLnV0aWwuc3RyKFwicmFuZG9tLmNsaWNrXCIpLCAxLjAsIDEuOCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICRpdGVtc3RhY2s7XG4gICAgfTtcbiAgICBmdW5jdGlvbiBpbnRlcm5hbF9yZWcoKSB7XG4gICAgICAgIHZhciBhcl9pdGVtID0gKG5ldyBubWlfQXNzYXVsdFJpZmxlKCkpLiRzZXRVbmxvY2FsaXplZE5hbWUoTW9kQVBJLnV0aWwuc3RyKFwiYXNzYXVsdHJpZmxlXCIpKS4kc2V0TWF4U3RhY2tTaXplKDEpO1xuICAgICAgICBpdGVtQ2xhc3Muc3RhdGljTWV0aG9kcy5yZWdpc3Rlckl0ZW0ubWV0aG9kKE1vZEFQSS5rZXlnZW4uaXRlbShcImFzc2F1bHRyaWZsZVwiKSwgTW9kQVBJLnV0aWwuc3RyKFwiYXNzYXVsdHJpZmxlXCIpLCBhcl9pdGVtKTtcbiAgICAgICAgTW9kQVBJLml0ZW1zW1wiYXNzYXVsdHJpZmxlXCJdID0gYXJfaXRlbTtcbiAgICAgICAgcmV0dXJuIGFyX2l0ZW07XG4gICAgfVxuICAgIGlmIChNb2RBUEkuaXRlbXMpIHtcbiAgICAgICAgcmV0dXJuIGludGVybmFsX3JlZygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgTW9kQVBJLmFkZEV2ZW50TGlzdGVuZXIoXCJib290c3RyYXBcIiwgaW50ZXJuYWxfcmVnKTtcbiAgICB9XG59XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGVmYXVsdCA9IFBpc3RvbEl0ZW07XG5mdW5jdGlvbiBQaXN0b2xJdGVtKCkge1xuICAgIHZhciByZWNvaWxTcGVlZCA9IDE7IC8vcmVjb2lsIGNvbnRyb2xsZXJcbiAgICB2YXIgRGFtYWdlU291cmNlQ2xhc3MgPSBNb2RBUEkucmVmbGVjdC5nZXRDbGFzc0J5TmFtZShcIkRhbWFnZVNvdXJjZVwiKTtcbiAgICB2YXIgY3JlYXRpdmVNaXNjVGFiID0gTW9kQVBJLnJlZmxlY3QuZ2V0Q2xhc3NCeUlkKFwibmV0Lm1pbmVjcmFmdC5jcmVhdGl2ZXRhYi5DcmVhdGl2ZVRhYnNcIikuc3RhdGljVmFyaWFibGVzLnRhYk1pc2M7XG4gICAgdmFyIGl0ZW1DbGFzcyA9IE1vZEFQSS5yZWZsZWN0LmdldENsYXNzQnlJZChcIm5ldC5taW5lY3JhZnQuaXRlbS5JdGVtXCIpO1xuICAgIHZhciBpdGVtU3VwZXIgPSBNb2RBUEkucmVmbGVjdC5nZXRTdXBlcihpdGVtQ2xhc3MsIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4Lmxlbmd0aCA9PT0gMTsgfSk7XG4gICAgdmFyIG5taV9JdGVtUGlzdG9sID0gZnVuY3Rpb24gbm1pX0l0ZW1QaXN0b2woKSB7XG4gICAgICAgIGl0ZW1TdXBlcih0aGlzKTsgLy9Vc2Ugc3VwZXIgZnVuY3Rpb24gdG8gZ2V0IGJsb2NrIHByb3BlcnRpZXMgb24gdGhpcyBjbGFzcy5cbiAgICAgICAgdGhpcy4kc2V0Q3JlYXRpdmVUYWIoY3JlYXRpdmVNaXNjVGFiKTtcbiAgICB9O1xuICAgIE1vZEFQSS5hZGRFdmVudExpc3RlbmVyKFwidXBkYXRlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgTW9kQVBJLnBsYXllci5yb3RhdGlvblBpdGNoIC09IHJlY29pbFNwZWVkO1xuICAgICAgICByZWNvaWxTcGVlZCAqPSAwLjc7XG4gICAgfSk7XG4gICAgZnVuY3Rpb24gZW50aXR5UmF5Q2FzdChwbGF5ZXIsIHdvcmxkLCByYW5nZSkge1xuICAgICAgICB2YXIgSEVBRFNIT1RfTUFYX0RJU1RBTkNFX0ZST01fSEVBRCA9IDAuNzI7XG4gICAgICAgIHZhciBleWVQb3NpdGlvbiA9IHBsYXllci5nZXRQb3NpdGlvbkV5ZXMoMC4wKTtcbiAgICAgICAgdmFyIHRhcmdldFBvc2l0aW9uID0gcGxheWVyLnJheVRyYWNlKHJhbmdlLCAwKS5oaXRWZWM7XG4gICAgICAgIHZhciBlbnRpdGllcyA9IHdvcmxkLmdldEVudGl0aWVzV2l0aGluQUFCQkV4Y2x1ZGluZ0VudGl0eShwbGF5ZXIuZ2V0UmVmKCksIHBsYXllci5nZXRFbnRpdHlCb3VuZGluZ0JveCgpLmV4cGFuZChyYW5nZSwgcmFuZ2UsIHJhbmdlKS5nZXRSZWYoKSkuZ2V0Q29ycmVjdGl2ZSgpLmFycmF5O1xuICAgICAgICB2YXIgY2xvc2VzdEVudGl0eSA9IG51bGw7XG4gICAgICAgIHZhciBpc0hlYWRzaG90ID0gZmFsc2U7XG4gICAgICAgIHZhciBpc0hlYWRzaG90SW50ID0gMDtcbiAgICAgICAgdmFyIGNsb3Nlc3REaXN0YW5jZSA9IHJhbmdlO1xuICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggYWxsIGVudGl0aWVzIHRvIGZpbmQgdGhlIG9uZSB0aGUgcGxheWVyIGlzIGxvb2tpbmcgYXRcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbnRpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKCFlbnRpdGllc1tpXSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGVudGl0eSA9IGVudGl0aWVzW2ldO1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGVudGl0eSdzIGJvdW5kaW5nIGJveCBpbnRlcnNlY3RzIHdpdGggdGhlIHBsYXllcidzIHJheVxuICAgICAgICAgICAgdmFyIGVudGl0eUJCID0gZW50aXR5LmdldEVudGl0eUJvdW5kaW5nQm94KCkuZXhwYW5kKDAuMywgMC4zLCAwLjMpO1xuICAgICAgICAgICAgdmFyIGludGVyY2VwdCA9IGVudGl0eUJCLmNhbGN1bGF0ZUludGVyY2VwdChleWVQb3NpdGlvbi5nZXRSZWYoKSwgdGFyZ2V0UG9zaXRpb24uZ2V0UmVmKCkpO1xuICAgICAgICAgICAgaWYgKGludGVyY2VwdCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gZXllUG9zaXRpb24uZGlzdGFuY2VUbyhpbnRlcmNlcHQuaGl0VmVjLmdldFJlZigpKTtcbiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPCBjbG9zZXN0RGlzdGFuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERpc3RhbmNlID0gZGlzdGFuY2U7XG4gICAgICAgICAgICAgICAgICAgIGNsb3Nlc3RFbnRpdHkgPSBlbnRpdHk7XG4gICAgICAgICAgICAgICAgICAgIGlzSGVhZHNob3QgPSBlbnRpdHkuZ2V0UG9zaXRpb25FeWVzKDAuMCkuZGlzdGFuY2VUbyhpbnRlcmNlcHQuaGl0VmVjLmdldFJlZigpKSA8IEhFQURTSE9UX01BWF9ESVNUQU5DRV9GUk9NX0hFQUQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0hlYWRzaG90KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpc0hlYWRzaG90SW50ID0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgcmF5VHJhY2VSZXN1bHQgPSBjbG9zZXN0RW50aXR5O1xuICAgICAgICBpZiAocmF5VHJhY2VSZXN1bHQgIT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgZW50aXR5OiByYXlUcmFjZVJlc3VsdCwgaGVhZHNob3Q6IGlzSGVhZHNob3QsIGludGhlYWRzaG90OiBpc0hlYWRzaG90SW50IH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBNb2RBUEkucmVmbGVjdC5wcm90b3R5cGVTdGFjayhpdGVtQ2xhc3MsIG5taV9JdGVtUGlzdG9sKTtcbiAgICBubWlfSXRlbVBpc3RvbC5wcm90b3R5cGUuJG9uSXRlbVJpZ2h0Q2xpY2sgPSBmdW5jdGlvbiAoJGl0ZW1zdGFjaywgJHdvcmxkLCAkcGxheWVyKSB7XG4gICAgICAgIHZhciBjYWN0dXMgPSBEYW1hZ2VTb3VyY2VDbGFzcy5zdGF0aWNWYXJpYWJsZXMuY2FjdHVzO1xuICAgICAgICB2YXIgd29ybGQgPSBNb2RBUEkudXRpbC53cmFwKCR3b3JsZCk7XG4gICAgICAgIHZhciBlbnRpdHlwbGF5ZXIgPSBNb2RBUEkudXRpbC53cmFwKCRwbGF5ZXIpO1xuICAgICAgICB2YXIgc2hvdGVudGl0eWRhdGEgPSBlbnRpdHlSYXlDYXN0KGVudGl0eXBsYXllciwgd29ybGQsIDE2LjApO1xuICAgICAgICBpZiAoc2hvdGVudGl0eWRhdGEgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHdvcmxkLmlzUmVtb3RlKSB7XG4gICAgICAgICAgICAgICAgcmVjb2lsU3BlZWQgKz0gNDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNob3RlbnRpdHlkYXRhLmVudGl0eS5hdHRhY2tFbnRpdHlGcm9tKGNhY3R1cywgMTAgKyAoMTYgKiBzaG90ZW50aXR5ZGF0YS5pbnRoZWFkc2hvdCkpO1xuICAgICAgICAgICAgICAgIGlmIChzaG90ZW50aXR5ZGF0YS5oZWFkc2hvdCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkggRSBBIEQgUyBIIE8gVFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd29ybGQucGxheVNvdW5kQXRFbnRpdHkoZW50aXR5cGxheWVyLmdldFJlZigpLCBNb2RBUEkudXRpbC5zdHIoXCJ0aWxlLnBpc3Rvbi5vdXRcIiksIDEuMCwgMS44KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghd29ybGQuaXNSZW1vdGUpIHtcbiAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZEF0RW50aXR5KGVudGl0eXBsYXllci5nZXRSZWYoKSwgTW9kQVBJLnV0aWwuc3RyKFwicmFuZG9tLmNsaWNrXCIpLCAxLjAsIDEuOCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICRpdGVtc3RhY2s7XG4gICAgfTtcbiAgICBmdW5jdGlvbiBpbnRlcm5hbF9yZWcoKSB7XG4gICAgICAgIHZhciBwaXN0b2xfaXRlbSA9IChuZXcgbm1pX0l0ZW1QaXN0b2woKSkuJHNldFVubG9jYWxpemVkTmFtZShNb2RBUEkudXRpbC5zdHIoXCJwaXN0b2xcIikpLiRzZXRNYXhTdGFja1NpemUoMSk7XG4gICAgICAgIGl0ZW1DbGFzcy5zdGF0aWNNZXRob2RzLnJlZ2lzdGVySXRlbS5tZXRob2QoTW9kQVBJLmtleWdlbi5pdGVtKFwicGlzdG9sXCIpLCBNb2RBUEkudXRpbC5zdHIoXCJwaXN0b2xcIiksIHBpc3RvbF9pdGVtKTtcbiAgICAgICAgTW9kQVBJLml0ZW1zW1wicGlzdG9sXCJdID0gcGlzdG9sX2l0ZW07XG4gICAgICAgIHJldHVybiBwaXN0b2xfaXRlbTtcbiAgICB9XG4gICAgaWYgKE1vZEFQSS5pdGVtcykge1xuICAgICAgICByZXR1cm4gaW50ZXJuYWxfcmVnKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBNb2RBUEkuYWRkRXZlbnRMaXN0ZW5lcihcImJvb3RzdHJhcFwiLCBpbnRlcm5hbF9yZWcpO1xuICAgIH1cbn1cbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGcgPSBPYmplY3QuY3JlYXRlKCh0eXBlb2YgSXRlcmF0b3IgPT09IFwiZnVuY3Rpb25cIiA/IEl0ZXJhdG9yIDogT2JqZWN0KS5wcm90b3R5cGUpO1xuICAgIHJldHVybiBnLm5leHQgPSB2ZXJiKDApLCBnW1widGhyb3dcIl0gPSB2ZXJiKDEpLCBnW1wicmV0dXJuXCJdID0gdmVyYigyKSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xuICAgICAgICB3aGlsZSAoZyAmJiAoZyA9IDAsIG9wWzBdICYmIChfID0gMCkpLCBfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBQaXN0b2xfMSA9IHJlcXVpcmUoXCIuL2d1bnMvUGlzdG9sXCIpO1xudmFyIEFzc2F1bHRSaWZsZV8xID0gcmVxdWlyZShcIi4vZ3Vucy9Bc3NhdWx0UmlmbGVcIik7XG52YXIgaXRlbVRleHR1cmUgPSBcImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0NBWUFBQUJ6ZW5yMEFBQUFBWE5TUjBJQXJzNGM2UUFBQUFSblFVMUJBQUN4and2OFlRVUFBQUFKY0VoWmN3QUFEc01BQUE3REFjZHZxR1FBQUFEeVNVUkJWRmhIN1pReERvTXdERVZOcjRHNlZtSkM2bWs0SXRkaDdWcHhqc0JQRGFLVkNMWnh5cEluSWNjZzV6cy9DVlFvS0FqOHVITGplRVRvdW82SHZsUWNVM3lKOTMyUElLa1RjZVJBRkg4TkE2ZEUzSXpiVm9nZFFCT1B0dVZYZms1SUo4aldoS1k0U3hQYVF2Y21MRVd1VFVqL0Exc3FpRUVjVFFCRU5EV2p2aDNtdlp0eGNjTGl3TXF2RTBEcmhOVUJDQ3kxS1NkQVVzUGl3RlljcE01RU5yWVdoM3RkSTRjVDRkazBNU0tQWHpNU1JTQytQTWkxNG1jTzRlN2VzdjJpSnF5SEVHRFZQQ1I2anlNQzVsdUVSWE9mdW9ZN1FGaThNS3NEZTZ0WGs4T0J2N0dlL0U5NkRaZUtGd29PRUUxd1VYN1RGaDV6c2dBQUFBQkpSVTVFcmtKZ2dnPT1cIjtcbk1vZEFQSS5tZXRhLnRpdGxlKFwiRG9udXQncyBHdW4gTW9kXCIpO1xuTW9kQVBJLm1ldGEudmVyc2lvbihcIndJUFwiKTtcbk1vZEFQSS5tZXRhLmljb24oaXRlbVRleHR1cmUpO1xuTW9kQVBJLm1ldGEuZGVzY3JpcHRpb24oXCJSZXF1aXJlcyBBc3luY1NpbmsuIFNvIGZhciBqdXN0IHNraWRkZWQgY29kZSBmcm9tIHJhZG1hblwiKTtcbk1vZEFQSS5kZWRpY2F0ZWRTZXJ2ZXIuYXBwZW5kQ29kZShQaXN0b2xfMS5kZWZhdWx0KTtcbk1vZEFQSS5kZWRpY2F0ZWRTZXJ2ZXIuYXBwZW5kQ29kZShBc3NhdWx0UmlmbGVfMS5kZWZhdWx0KTtcbnZhciBwaXN0b2xfaXRlbSA9ICgwLCBQaXN0b2xfMS5kZWZhdWx0KSgpO1xudmFyIGFyX2l0ZW0gPSAoMCwgQXNzYXVsdFJpZmxlXzEuZGVmYXVsdCkoKTtcbk1vZEFQSS5hZGRFdmVudExpc3RlbmVyKFwibGliOmFzeW5jc2lua1wiLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2QpIHtcbiAgICAgICAgc3dpdGNoIChfZC5sYWJlbCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIE1vZEFQSS5hZGRFdmVudExpc3RlbmVyKFwiY3VzdG9tOmFzeW5jc2lua19yZWxvYWRlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIE1vZEFQSS5tYy5yZW5kZXJJdGVtLnJlZ2lzdGVySXRlbShwaXN0b2xfaXRlbSwgTW9kQVBJLnV0aWwuc3RyKFwicGlzdG9sXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgTW9kQVBJLm1jLnJlbmRlckl0ZW0ucmVnaXN0ZXJJdGVtKGFyX2l0ZW0sIE1vZEFQSS51dGlsLnN0cihcImFzc2F1bHRyaWZsZVwiKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgQXN5bmNTaW5rLkwxME4uc2V0KFwiaXRlbS5waXN0b2wubmFtZVwiLCBcIlBpc3RvbFwiKTtcbiAgICAgICAgICAgICAgICBBc3luY1NpbmsuTDEwTi5zZXQoXCJpdGVtLmFzc2F1bHRyaWZsZS5uYW1lXCIsIFwiQXNzYXVsdCBSaWZsZVwiKTtcbiAgICAgICAgICAgICAgICBBc3luY1Npbmsuc2V0RmlsZShcInJlc291cmNlcGFja3MvQXN5bmNTaW5rTGliL2Fzc2V0cy9taW5lY3JhZnQvbW9kZWxzL2l0ZW0vcGlzdG9sLmpzb25cIiwgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICBcInBhcmVudFwiOiBcImJ1aWx0aW4vZ2VuZXJhdGVkXCIsXG4gICAgICAgICAgICAgICAgICAgIFwidGV4dHVyZXNcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYXllcjBcIjogXCJpdGVtcy9waXN0b2xcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBcImRpc3BsYXlcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aGlyZHBlcnNvblwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJyb3RhdGlvblwiOiBbNSwgODAsIC00NV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmFuc2xhdGlvblwiOiBbMCwgMSwgLTNdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2NhbGVcIjogWzEuMCwgMS4wLCAxLjBdXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJmaXJzdHBlcnNvblwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJyb3RhdGlvblwiOiBbMCwgLTEzNSwgMjVdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHJhbnNsYXRpb25cIjogWzAsIDQsIDJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2NhbGVcIjogWzEuOCwgMS44LCAxLjhdXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgX2IgPSAoX2EgPSBBc3luY1NpbmspLnNldEZpbGU7XG4gICAgICAgICAgICAgICAgX2MgPSBbXCJyZXNvdXJjZXBhY2tzL0FzeW5jU2lua0xpYi9hc3NldHMvbWluZWNyYWZ0L3RleHR1cmVzL2l0ZW1zL3Bpc3RvbC5wbmdcIl07XG4gICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgZmV0Y2goaXRlbVRleHR1cmUpXTtcbiAgICAgICAgICAgIGNhc2UgMTogcmV0dXJuIFs0IC8qeWllbGQqLywgKF9kLnNlbnQoKSkuYXJyYXlCdWZmZXIoKV07XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgX2IuYXBwbHkoX2EsIF9jLmNvbmNhdChbX2Quc2VudCgpXSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7IH0pO1xuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyhcIi4vc3JjL21haW4udHNcIik7XG4iXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJEYW1hZ2VTb3VyY2VDbGFzcyIsIk1vZEFQSSIsInJlZmxlY3QiLCJnZXRDbGFzc0J5TmFtZSIsImNyZWF0aXZlTWlzY1RhYiIsImdldENsYXNzQnlJZCIsInN0YXRpY1ZhcmlhYmxlcyIsInRhYk1pc2MiLCJpdGVtQ2xhc3MiLCJpdGVtU3VwZXIiLCJnZXRTdXBlciIsIngiLCJsZW5ndGgiLCJubWlfQXNzYXVsdFJpZmxlIiwidGhpcyIsIiRzZXRDcmVhdGl2ZVRhYiIsImFkZEV2ZW50TGlzdGVuZXIiLCJwcm90b3R5cGVTdGFjayIsImhhc1Nob3QiLCJpbnRlcm5hbF9yZWciLCJhcl9pdGVtIiwiJHNldFVubG9jYWxpemVkTmFtZSIsInV0aWwiLCJzdHIiLCIkc2V0TWF4U3RhY2tTaXplIiwic3RhdGljTWV0aG9kcyIsInJlZ2lzdGVySXRlbSIsIm1ldGhvZCIsImtleWdlbiIsIml0ZW0iLCJpdGVtcyIsInByb3RvdHlwZSIsIiRvblBsYXllclN0b3BwZWRVc2luZyIsIiRpdGVtc3RhY2siLCIkb25JdGVtVXNlRmluaXNoIiwiJGdldE1heEl0ZW1Vc2VEdXJhdGlvbiIsIiRnZXRJdGVtVXNlQWN0aW9uIiwiRFJJTksiLCIkb25JdGVtUmlnaHRDbGljayIsIiR3b3JsZCIsIiRwbGF5ZXIiLCJjYWN0dXMiLCJ3b3JsZCIsIndyYXAiLCJlbnRpdHlwbGF5ZXIiLCJzaG90ZW50aXR5ZGF0YSIsInBsYXllciIsImV5ZVBvc2l0aW9uIiwiZ2V0UG9zaXRpb25FeWVzIiwidGFyZ2V0UG9zaXRpb24iLCJyYXlUcmFjZSIsImhpdFZlYyIsImVudGl0aWVzIiwiZ2V0RW50aXRpZXNXaXRoaW5BQUJCRXhjbHVkaW5nRW50aXR5IiwiZ2V0UmVmIiwiZ2V0RW50aXR5Qm91bmRpbmdCb3giLCJleHBhbmQiLCJnZXRDb3JyZWN0aXZlIiwiYXJyYXkiLCJjbG9zZXN0RW50aXR5IiwiaXNIZWFkc2hvdCIsImlzSGVhZHNob3RJbnQiLCJjbG9zZXN0RGlzdGFuY2UiLCJlbnVtUGFydGljbGVTbW9rZSIsIlNNT0tFX05PUk1BTCIsInBsYXllclgiLCJwb3NYIiwicGxheWVyWSIsInBvc1kiLCJwbGF5ZXJaIiwicG9zWiIsImRpclgiLCJ4Q29vcmQiLCJkaXJZIiwieUNvb3JkIiwiZGlyWiIsInpDb29yZCIsImRpc3RhbmNlIiwiTWF0aCIsInNxcnQiLCJzdGVwWCIsInN0ZXBZIiwic3RlcFoiLCJzdGVwU2l6ZSIsImkiLCJzcGF3blBhcnRpY2xlIiwiZW50aXR5IiwiaW50ZXJjZXB0IiwiY2FsY3VsYXRlSW50ZXJjZXB0IiwiZGlzdGFuY2VUb0VudGl0eSIsImRpc3RhbmNlVG8iLCJoZWFkc2hvdCIsImludGhlYWRzaG90IiwiZW50aXR5UmF5Q2FzdCIsInNldEl0ZW1JblVzZSIsImlzUmVtb3RlIiwiYXR0YWNrRW50aXR5RnJvbSIsImNvbnNvbGUiLCJsb2ciLCJwbGF5U291bmRBdEVudGl0eSIsInJlY29pbFNwZWVkIiwibm1pX0l0ZW1QaXN0b2wiLCJwaXN0b2xfaXRlbSIsInJvdGF0aW9uUGl0Y2giLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIl9fZ2VuZXJhdG9yIiwiYm9keSIsImYiLCJ5IiwidCIsIl8iLCJsYWJlbCIsInNlbnQiLCJ0cnlzIiwib3BzIiwiZyIsImNyZWF0ZSIsIkl0ZXJhdG9yIiwidmVyYiIsIlN5bWJvbCIsIml0ZXJhdG9yIiwibiIsInYiLCJvcCIsIlR5cGVFcnJvciIsImNhbGwiLCJwb3AiLCJwdXNoIiwiUGlzdG9sXzEiLCJBc3NhdWx0UmlmbGVfMSIsIml0ZW1UZXh0dXJlIiwibWV0YSIsInRpdGxlIiwidmVyc2lvbiIsImljb24iLCJkZXNjcmlwdGlvbiIsImRlZGljYXRlZFNlcnZlciIsImFwcGVuZENvZGUiLCJkZWZhdWx0IiwiX2EiLCJfYiIsIl9jIiwiX2QiLCJtYyIsInJlbmRlckl0ZW0iLCJBc3luY1NpbmsiLCJMMTBOIiwic2V0Iiwic2V0RmlsZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJmZXRjaCIsImFycmF5QnVmZmVyIiwiY29uY2F0IiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyJdLCJzb3VyY2VSb290IjoiIn0=